import{r as A,c as Qt,j as b,R as Jt,A as _t,u as $t,d as rt,b as dt,e as zt}from"./index-VyhKji2U.js";import{u as te,a as pt,C as ee,O as ne,F as ie,T as xt}from"./Float-DNRs5TNb.js";import{da as se,D as Ot,a as D,V as re,a7 as Ut,a5 as Lt,df as oe,b7 as le,dg as Ft,d as Wt,cG as ae}from"./extends-BVG4NNlv.js";import"./with-selector-BwKRMBZb.js";const ot=new D,Mt=new D,ce=new D,Tt=new re;function he(h,t,e){const i=ot.setFromMatrixPosition(h.matrixWorld);i.project(t);const n=e.width/2,s=e.height/2;return[i.x*n+n,-(i.y*s)+s]}function ue(h,t){const e=ot.setFromMatrixPosition(h.matrixWorld),i=Mt.setFromMatrixPosition(t.matrixWorld),n=e.sub(i),s=t.getWorldDirection(ce);return n.angleTo(s)>Math.PI/2}function fe(h,t,e,i){const n=ot.setFromMatrixPosition(h.matrixWorld),s=n.clone();s.project(t),Tt.set(s.x,s.y),e.setFromCamera(Tt,t);const r=e.intersectObjects(i,!0);if(r.length){const o=r[0].distance;return n.distanceTo(e.ray.origin)<o}return!0}function de(h,t){if(t instanceof Lt)return t.zoom;if(t instanceof Ut){const e=ot.setFromMatrixPosition(h.matrixWorld),i=Mt.setFromMatrixPosition(t.matrixWorld),n=t.fov*Math.PI/180,s=e.distanceTo(i);return 1/(2*Math.tan(n/2)*s)}else return 1}function me(h,t,e){if(t instanceof Ut||t instanceof Lt){const i=ot.setFromMatrixPosition(h.matrixWorld),n=Mt.setFromMatrixPosition(t.matrixWorld),s=i.distanceTo(n),r=(e[1]-e[0])/(t.far-t.near),o=e[1]-r*t.far;return Math.round(r*s+o)}}const vt=h=>Math.abs(h)<1e-10?0:h;function Vt(h,t,e=""){let i="matrix3d(";for(let n=0;n!==16;n++)i+=vt(t[n]*h.elements[n])+(n!==15?",":")");return e+i}const pe=(h=>t=>Vt(t,h))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),ge=(h=>(t,e)=>Vt(t,h(e),"translate(-50%,-50%)"))(h=>[1/h,1/h,1/h,1,-1/h,-1/h,-1/h,-1,1/h,1/h,1/h,1,1,1,1,1]);function xe(h){return h&&typeof h=="object"&&"current"in h}const Dt=A.forwardRef(({children:h,eps:t=.001,style:e,className:i,prepend:n,center:s,fullscreen:r,portal:o,distanceFactor:l,sprite:f=!1,transform:u=!1,occlude:a,onOcclude:c,castShadow:d,receiveShadow:m,material:p,geometry:y,zIndexRange:g=[16777271,0],calculatePosition:_=he,as:w="div",wrapperClass:M,pointerEvents:S="auto",...j},C)=>{const{gl:E,camera:x,scene:P,size:v,raycaster:T,events:R,viewport:z}=te(),[N]=A.useState(()=>document.createElement(w)),k=A.useRef(null),I=A.useRef(null),U=A.useRef(0),O=A.useRef([0,0]),V=A.useRef(null),nt=A.useRef(null),q=o?.current||R.connected||E.domElement.parentNode,G=A.useRef(null),at=A.useRef(!1),ct=A.useMemo(()=>a&&a!=="blending"||Array.isArray(a)&&a.length&&xe(a[0]),[a]);A.useLayoutEffect(()=>{const W=E.domElement;a&&a==="blending"?(W.style.zIndex=`${Math.floor(g[0]/2)}`,W.style.position="absolute",W.style.pointerEvents="none"):(W.style.zIndex=null,W.style.position=null,W.style.pointerEvents=null)},[a]),A.useLayoutEffect(()=>{if(I.current){const W=k.current=Qt.createRoot(N);if(P.updateMatrixWorld(),u)N.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const $=_(I.current,x,v);N.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${$[0]}px,${$[1]}px,0);transform-origin:0 0;`}return q&&(n?q.prepend(N):q.appendChild(N)),()=>{q&&q.removeChild(N),W.unmount()}}},[q,u]),A.useLayoutEffect(()=>{M&&(N.className=M)},[M]);const St=A.useMemo(()=>u?{position:"absolute",top:0,left:0,width:v.width,height:v.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...r&&{top:-v.height/2,left:-v.width/2,width:v.width,height:v.height},...e},[e,s,r,v,u]),Ht=A.useMemo(()=>({position:"absolute",pointerEvents:S}),[S]);A.useLayoutEffect(()=>{if(at.current=!1,u){var W;(W=k.current)==null||W.render(A.createElement("div",{ref:V,style:St},A.createElement("div",{ref:nt,style:Ht},A.createElement("div",{ref:C,className:i,style:e,children:h}))))}else{var $;($=k.current)==null||$.render(A.createElement("div",{ref:C,style:St,className:i,children:h}))}});const Q=A.useRef(!0);pt(W=>{if(I.current){x.updateMatrixWorld(),I.current.updateWorldMatrix(!0,!1);const $=u?O.current:_(I.current,x,v);if(u||Math.abs(U.current-x.zoom)>t||Math.abs(O.current[0]-$[0])>t||Math.abs(O.current[1]-$[1])>t){const K=ue(I.current,x);let H=!1;ct&&(Array.isArray(a)?H=a.map(Y=>Y.current):a!=="blending"&&(H=[P]));const it=Q.current;if(H){const Y=fe(I.current,x,T,H);Q.current=Y&&!K}else Q.current=!K;it!==Q.current&&(c?c(!Q.current):N.style.display=Q.current?"block":"none");const ht=Math.floor(g[0]/2),Bt=a?ct?[g[0],ht]:[ht-1,0]:g;if(N.style.zIndex=`${me(I.current,x,Bt)}`,u){const[Y,At]=[v.width/2,v.height/2],gt=x.projectionMatrix.elements[5]*At,{isOrthographicCamera:kt,top:Gt,left:Kt,bottom:Yt,right:Zt}=x,Xt=pe(x.matrixWorldInverse),qt=kt?`scale(${gt})translate(${vt(-(Zt+Kt)/2)}px,${vt((Gt+Yt)/2)}px)`:`translateZ(${gt}px)`;let Z=I.current.matrixWorld;f&&(Z=x.matrixWorldInverse.clone().transpose().copyPosition(Z).scale(I.current.scale),Z.elements[3]=Z.elements[7]=Z.elements[11]=0,Z.elements[15]=1),N.style.width=v.width+"px",N.style.height=v.height+"px",N.style.perspective=kt?"":`${gt}px`,V.current&&nt.current&&(V.current.style.transform=`${qt}${Xt}translate(${Y}px,${At}px)`,nt.current.style.transform=ge(Z,1/((l||10)/400)))}else{const Y=l===void 0?1:de(I.current,x)*l;N.style.transform=`translate3d(${$[0]}px,${$[1]}px,0) scale(${Y})`}O.current=$,U.current=x.zoom}}if(!ct&&G.current&&!at.current)if(u){if(V.current){const $=V.current.children[0];if($!=null&&$.clientWidth&&$!=null&&$.clientHeight){const{isOrthographicCamera:K}=x;if(K||y)j.scale&&(Array.isArray(j.scale)?j.scale instanceof D?G.current.scale.copy(j.scale.clone().divideScalar(1)):G.current.scale.set(1/j.scale[0],1/j.scale[1],1/j.scale[2]):G.current.scale.setScalar(1/j.scale));else{const H=(l||10)/400,it=$.clientWidth*H,ht=$.clientHeight*H;G.current.scale.set(it,ht,1)}at.current=!0}}}else{const $=N.children[0];if($!=null&&$.clientWidth&&$!=null&&$.clientHeight){const K=1/z.factor,H=$.clientWidth*K,it=$.clientHeight*K;G.current.scale.set(H,it,1),at.current=!0}G.current.lookAt(W.camera.position)}});const Pt=A.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return A.createElement("group",se({},j,{ref:I}),a&&!ct&&A.createElement("mesh",{castShadow:d,receiveShadow:m,ref:G},y||A.createElement("planeGeometry",null),p||A.createElement("shaderMaterial",{side:Ot,vertexShader:Pt.vertexShader,fragmentShader:Pt.fragmentShader})))}),B=11102230246251565e-32,L=134217729,ye=(3+8*B)*B;function yt(h,t,e,i,n){let s,r,o,l,f=t[0],u=i[0],a=0,c=0;u>f==u>-f?(s=f,f=t[++a]):(s=u,u=i[++c]);let d=0;if(a<h&&c<e)for(u>f==u>-f?(r=f+s,o=s-(r-f),f=t[++a]):(r=u+s,o=s-(r-u),u=i[++c]),s=r,o!==0&&(n[d++]=o);a<h&&c<e;)u>f==u>-f?(r=s+f,l=r-s,o=s-(r-l)+(f-l),f=t[++a]):(r=s+u,l=r-s,o=s-(r-l)+(u-l),u=i[++c]),s=r,o!==0&&(n[d++]=o);for(;a<h;)r=s+f,l=r-s,o=s-(r-l)+(f-l),f=t[++a],s=r,o!==0&&(n[d++]=o);for(;c<e;)r=s+u,l=r-s,o=s-(r-l)+(u-l),u=i[++c],s=r,o!==0&&(n[d++]=o);return(s!==0||d===0)&&(n[d++]=s),d}function be(h,t){let e=t[0];for(let i=1;i<h;i++)e+=t[i];return e}function lt(h){return new Float64Array(h)}const _e=(3+16*B)*B,ve=(2+12*B)*B,we=(9+64*B)*B*B,J=lt(4),It=lt(8),Nt=lt(12),Ct=lt(16),F=lt(4);function Me(h,t,e,i,n,s,r){let o,l,f,u,a,c,d,m,p,y,g,_,w,M,S,j,C,E;const x=h-n,P=e-n,v=t-s,T=i-s;M=x*T,c=L*x,d=c-(c-x),m=x-d,c=L*T,p=c-(c-T),y=T-p,S=m*y-(M-d*p-m*p-d*y),j=v*P,c=L*v,d=c-(c-v),m=v-d,c=L*P,p=c-(c-P),y=P-p,C=m*y-(j-d*p-m*p-d*y),g=S-C,a=S-g,J[0]=S-(g+a)+(a-C),_=M+g,a=_-M,w=M-(_-a)+(g-a),g=w-j,a=w-g,J[1]=w-(g+a)+(a-j),E=_+g,a=E-_,J[2]=_-(E-a)+(g-a),J[3]=E;let R=be(4,J),z=ve*r;if(R>=z||-R>=z||(a=h-x,o=h-(x+a)+(a-n),a=e-P,f=e-(P+a)+(a-n),a=t-v,l=t-(v+a)+(a-s),a=i-T,u=i-(T+a)+(a-s),o===0&&l===0&&f===0&&u===0)||(z=we*r+ye*Math.abs(R),R+=x*u+T*o-(v*f+P*l),R>=z||-R>=z))return R;M=o*T,c=L*o,d=c-(c-o),m=o-d,c=L*T,p=c-(c-T),y=T-p,S=m*y-(M-d*p-m*p-d*y),j=l*P,c=L*l,d=c-(c-l),m=l-d,c=L*P,p=c-(c-P),y=P-p,C=m*y-(j-d*p-m*p-d*y),g=S-C,a=S-g,F[0]=S-(g+a)+(a-C),_=M+g,a=_-M,w=M-(_-a)+(g-a),g=w-j,a=w-g,F[1]=w-(g+a)+(a-j),E=_+g,a=E-_,F[2]=_-(E-a)+(g-a),F[3]=E;const N=yt(4,J,4,F,It);M=x*u,c=L*x,d=c-(c-x),m=x-d,c=L*u,p=c-(c-u),y=u-p,S=m*y-(M-d*p-m*p-d*y),j=v*f,c=L*v,d=c-(c-v),m=v-d,c=L*f,p=c-(c-f),y=f-p,C=m*y-(j-d*p-m*p-d*y),g=S-C,a=S-g,F[0]=S-(g+a)+(a-C),_=M+g,a=_-M,w=M-(_-a)+(g-a),g=w-j,a=w-g,F[1]=w-(g+a)+(a-j),E=_+g,a=E-_,F[2]=_-(E-a)+(g-a),F[3]=E;const k=yt(N,It,4,F,Nt);M=o*u,c=L*o,d=c-(c-o),m=o-d,c=L*u,p=c-(c-u),y=u-p,S=m*y-(M-d*p-m*p-d*y),j=l*f,c=L*l,d=c-(c-l),m=l-d,c=L*f,p=c-(c-f),y=f-p,C=m*y-(j-d*p-m*p-d*y),g=S-C,a=S-g,F[0]=S-(g+a)+(a-C),_=M+g,a=_-M,w=M-(_-a)+(g-a),g=w-j,a=w-g,F[1]=w-(g+a)+(a-j),E=_+g,a=E-_,F[2]=_-(E-a)+(g-a),F[3]=E;const I=yt(k,Nt,4,F,Ct);return Ct[I-1]}function ut(h,t,e,i,n,s){const r=(t-s)*(e-n),o=(h-n)*(i-s),l=r-o,f=Math.abs(r+o);return Math.abs(l)>=_e*f?l:-Me(h,t,e,i,n,s,f)}const Et=Math.pow(2,-52),ft=new Uint32Array(512);class mt{static from(t,e=ke,i=Te){const n=t.length,s=new Float64Array(n*2);for(let r=0;r<n;r++){const o=t[r];s[2*r]=e(o),s[2*r+1]=i(o)}return new mt(s)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:i,_hullTri:n,_hullHash:s}=this,r=t.length>>1;let o=1/0,l=1/0,f=-1/0,u=-1/0;for(let x=0;x<r;x++){const P=t[2*x],v=t[2*x+1];P<o&&(o=P),v<l&&(l=v),P>f&&(f=P),v>u&&(u=v),this._ids[x]=x}const a=(o+f)/2,c=(l+u)/2;let d,m,p;for(let x=0,P=1/0;x<r;x++){const v=bt(a,c,t[2*x],t[2*x+1]);v<P&&(d=x,P=v)}const y=t[2*d],g=t[2*d+1];for(let x=0,P=1/0;x<r;x++){if(x===d)continue;const v=bt(y,g,t[2*x],t[2*x+1]);v<P&&v>0&&(m=x,P=v)}let _=t[2*m],w=t[2*m+1],M=1/0;for(let x=0;x<r;x++){if(x===d||x===m)continue;const P=Pe(y,g,_,w,t[2*x],t[2*x+1]);P<M&&(p=x,M=P)}let S=t[2*p],j=t[2*p+1];if(M===1/0){for(let v=0;v<r;v++)this._dists[v]=t[2*v]-t[0]||t[2*v+1]-t[1];et(this._ids,this._dists,0,r-1);const x=new Uint32Array(r);let P=0;for(let v=0,T=-1/0;v<r;v++){const R=this._ids[v],z=this._dists[R];z>T&&(x[P++]=R,T=z)}this.hull=x.subarray(0,P),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ut(y,g,_,w,S,j)<0){const x=m,P=_,v=w;m=p,_=S,w=j,p=x,S=P,j=v}const C=Ae(y,g,_,w,S,j);this._cx=C.x,this._cy=C.y;for(let x=0;x<r;x++)this._dists[x]=bt(t[2*x],t[2*x+1],C.x,C.y);et(this._ids,this._dists,0,r-1),this._hullStart=d;let E=3;i[d]=e[p]=m,i[m]=e[d]=p,i[p]=e[m]=d,n[d]=0,n[m]=1,n[p]=2,s.fill(-1),s[this._hashKey(y,g)]=d,s[this._hashKey(_,w)]=m,s[this._hashKey(S,j)]=p,this.trianglesLen=0,this._addTriangle(d,m,p,-1,-1,-1);for(let x=0,P,v;x<this._ids.length;x++){const T=this._ids[x],R=t[2*T],z=t[2*T+1];if(x>0&&Math.abs(R-P)<=Et&&Math.abs(z-v)<=Et||(P=R,v=z,T===d||T===m||T===p))continue;let N=0;for(let V=0,nt=this._hashKey(R,z);V<this._hashSize&&(N=s[(nt+V)%this._hashSize],!(N!==-1&&N!==i[N]));V++);N=e[N];let k=N,I;for(;I=i[k],ut(R,z,t[2*k],t[2*k+1],t[2*I],t[2*I+1])>=0;)if(k=I,k===N){k=-1;break}if(k===-1)continue;let U=this._addTriangle(k,T,i[k],-1,-1,n[k]);n[T]=this._legalize(U+2),n[k]=U,E++;let O=i[k];for(;I=i[O],ut(R,z,t[2*O],t[2*O+1],t[2*I],t[2*I+1])<0;)U=this._addTriangle(O,T,I,n[T],-1,n[O]),n[T]=this._legalize(U+2),i[O]=O,E--,O=I;if(k===N)for(;I=e[k],ut(R,z,t[2*I],t[2*I+1],t[2*k],t[2*k+1])<0;)U=this._addTriangle(I,T,k,-1,n[k],n[I]),this._legalize(U+2),n[I]=U,i[k]=k,E--,k=I;this._hullStart=e[T]=k,i[k]=e[O]=T,i[T]=O,s[this._hashKey(R,z)]=T,s[this._hashKey(t[2*k],t[2*k+1])]=k}this.hull=new Uint32Array(E);for(let x=0,P=this._hullStart;x<E;x++)this.hull[x]=P,P=i[P];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(je(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:i,coords:n}=this;let s=0,r=0;for(;;){const o=i[t],l=t-t%3;if(r=l+(t+2)%3,o===-1){if(s===0)break;t=ft[--s];continue}const f=o-o%3,u=l+(t+1)%3,a=f+(o+2)%3,c=e[r],d=e[t],m=e[u],p=e[a];if(Se(n[2*c],n[2*c+1],n[2*d],n[2*d+1],n[2*m],n[2*m+1],n[2*p],n[2*p+1])){e[t]=p,e[o]=c;const g=i[a];if(g===-1){let w=this._hullStart;do{if(this._hullTri[w]===a){this._hullTri[w]=t;break}w=this._hullPrev[w]}while(w!==this._hullStart)}this._link(t,g),this._link(o,i[r]),this._link(r,a);const _=f+(o+1)%3;s<ft.length&&(ft[s++]=_)}else{if(s===0)break;t=ft[--s]}}return r}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,i,n,s,r){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=i,this._link(o,n),this._link(o+1,s),this._link(o+2,r),this.trianglesLen+=3,o}}function je(h,t){const e=h/(Math.abs(h)+Math.abs(t));return(t>0?3-e:1+e)/4}function bt(h,t,e,i){const n=h-e,s=t-i;return n*n+s*s}function Se(h,t,e,i,n,s,r,o){const l=h-r,f=t-o,u=e-r,a=i-o,c=n-r,d=s-o,m=l*l+f*f,p=u*u+a*a,y=c*c+d*d;return l*(a*y-p*d)-f*(u*y-p*c)+m*(u*d-a*c)<0}function Pe(h,t,e,i,n,s){const r=e-h,o=i-t,l=n-h,f=s-t,u=r*r+o*o,a=l*l+f*f,c=.5/(r*f-o*l),d=(f*u-o*a)*c,m=(r*a-l*u)*c;return d*d+m*m}function Ae(h,t,e,i,n,s){const r=e-h,o=i-t,l=n-h,f=s-t,u=r*r+o*o,a=l*l+f*f,c=.5/(r*f-o*l),d=h+(f*u-o*a)*c,m=t+(r*a-l*u)*c;return{x:d,y:m}}function et(h,t,e,i){if(i-e<=20)for(let n=e+1;n<=i;n++){const s=h[n],r=t[s];let o=n-1;for(;o>=e&&t[h[o]]>r;)h[o+1]=h[o--];h[o+1]=s}else{const n=e+i>>1;let s=e+1,r=i;st(h,n,s),t[h[e]]>t[h[i]]&&st(h,e,i),t[h[s]]>t[h[i]]&&st(h,s,i),t[h[e]]>t[h[s]]&&st(h,e,s);const o=h[s],l=t[o];for(;;){do s++;while(t[h[s]]<l);do r--;while(t[h[r]]>l);if(r<s)break;st(h,s,r)}h[e+1]=h[r],h[r]=o,i-s+1>=r-e?(et(h,t,s,i),et(h,t,e,r-1)):(et(h,t,e,r-1),et(h,t,s,i))}}function st(h,t,e){const i=h[t];h[t]=h[e],h[e]=i}function ke(h){return h[0]}function Te(h){return h[1]}const Rt=1e-6;class X{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,i){t=+t,e=+e,i=+i;const n=t+i,s=e;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${s}`:(Math.abs(this._x1-n)>Rt||Math.abs(this._y1-s)>Rt)&&(this._+="L"+n+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${e}A${i},${i},0,1,1,${this._x1=n},${this._y1=s}`)}rect(t,e,i,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+i}v${+n}h${-i}Z`}value(){return this._||null}}class wt{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Ie{constructor(t,[e,i,n,s]=[0,0,960,500]){if(!((n=+n)>=(e=+e))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=n,this.xmin=e,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:n}=this;let s,r;const o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let p=0,y=0,g=i.length,_,w;p<g;p+=3,y+=2){const M=i[p]*2,S=i[p+1]*2,j=i[p+2]*2,C=t[M],E=t[M+1],x=t[S],P=t[S+1],v=t[j],T=t[j+1],R=x-C,z=P-E,N=v-C,k=T-E,I=(R*k-z*N)*2;if(Math.abs(I)<1e-9){if(s===void 0){s=r=0;for(const O of e)s+=t[O*2],r+=t[O*2+1];s/=e.length,r/=e.length}const U=1e9*Math.sign((s-C)*k-(r-E)*N);_=(C+v)/2-U*k,w=(E+T)/2+U*N}else{const U=1/I,O=R*R+z*z,V=N*N+k*k;_=C+(k*O-z*V)*U,w=E+(R*V-N*O)*U}o[y]=_,o[y+1]=w}let l=e[e.length-1],f,u=l*4,a,c=t[2*l],d,m=t[2*l+1];n.fill(0);for(let p=0;p<e.length;++p)l=e[p],f=u,a=c,d=m,u=l*4,c=t[2*l],m=t[2*l+1],n[f+2]=n[u]=d-m,n[f+3]=n[u+1]=c-a}render(t){const e=t==null?t=new X:void 0,{delaunay:{halfedges:i,inedges:n,hull:s},circumcenters:r,vectors:o}=this;if(s.length<=1)return null;for(let u=0,a=i.length;u<a;++u){const c=i[u];if(c<u)continue;const d=Math.floor(u/3)*2,m=Math.floor(c/3)*2,p=r[d],y=r[d+1],g=r[m],_=r[m+1];this._renderSegment(p,y,g,_,t)}let l,f=s[s.length-1];for(let u=0;u<s.length;++u){l=f,f=s[u];const a=Math.floor(n[f]/3)*2,c=r[a],d=r[a+1],m=l*4,p=this._project(c,d,o[m+2],o[m+3]);p&&this._renderSegment(c,d,p[0],p[1],t)}return e&&e.value()}renderBounds(t){const e=t==null?t=new X:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const i=e==null?e=new X:void 0,n=this._clip(t);if(n===null||!n.length)return;e.moveTo(n[0],n[1]);let s=n.length;for(;n[0]===n[s-2]&&n[1]===n[s-1]&&s>1;)s-=2;for(let r=2;r<s;r+=2)(n[r]!==n[r-2]||n[r+1]!==n[r-1])&&e.lineTo(n[r],n[r+1]);return e.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const n=this.cellPolygon(e);n&&(n.index=e,yield n)}}cellPolygon(t){const e=new wt;return this.renderCell(t,e),e.value()}_renderSegment(t,e,i,n,s){let r;const o=this._regioncode(t,e),l=this._regioncode(i,n);o===0&&l===0?(s.moveTo(t,e),s.lineTo(i,n)):(r=this._clipSegment(t,e,i,n,o,l))&&(s.moveTo(r[0],r[1]),s.lineTo(r[2],r[3]))}contains(t,e,i){return e=+e,e!==e||(i=+i,i!==i)?!1:this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const n=this._clip(i);if(n){t:for(let s=0,r=e.length;s<r;s+=2)for(let o=0,l=n.length;o<l;o+=2)if(e[s]===n[o]&&e[s+1]===n[o+1]&&e[(s+2)%r]===n[(o+l-2)%l]&&e[(s+3)%r]===n[(o+l-1)%l]){yield i;break t}}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:n,triangles:s}}=this,r=i[t];if(r===-1)return null;const o=[];let l=r;do{const f=Math.floor(l/3);if(o.push(e[f*2],e[f*2+1]),l=l%3===2?l-2:l+1,s[l]!==t)break;l=n[l]}while(l!==r&&l!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(e===null)return null;const{vectors:i}=this,n=t*4;return this._simplify(i[n]||i[n+1]?this._clipInfinite(t,e,i[n],i[n+1],i[n+2],i[n+3]):this._clipFinite(t,e))}_clipFinite(t,e){const i=e.length;let n=null,s,r,o=e[i-2],l=e[i-1],f,u=this._regioncode(o,l),a,c=0;for(let d=0;d<i;d+=2)if(s=o,r=l,o=e[d],l=e[d+1],f=u,u=this._regioncode(o,l),f===0&&u===0)a=c,c=0,n?n.push(o,l):n=[o,l];else{let m,p,y,g,_;if(f===0){if((m=this._clipSegment(s,r,o,l,f,u))===null)continue;[p,y,g,_]=m}else{if((m=this._clipSegment(o,l,s,r,u,f))===null)continue;[g,_,p,y]=m,a=c,c=this._edgecode(p,y),a&&c&&this._edge(t,a,c,n,n.length),n?n.push(p,y):n=[p,y]}a=c,c=this._edgecode(g,_),a&&c&&this._edge(t,a,c,n,n.length),n?n.push(g,_):n=[g,_]}if(n)a=c,c=this._edgecode(n[0],n[1]),a&&c&&this._edge(t,a,c,n,n.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(t,e,i,n,s,r){const o=s<r;for(o&&([t,e,i,n,s,r]=[i,n,t,e,r,s]);;){if(s===0&&r===0)return o?[i,n,t,e]:[t,e,i,n];if(s&r)return null;let l,f,u=s||r;u&8?(l=t+(i-t)*(this.ymax-e)/(n-e),f=this.ymax):u&4?(l=t+(i-t)*(this.ymin-e)/(n-e),f=this.ymin):u&2?(f=e+(n-e)*(this.xmax-t)/(i-t),l=this.xmax):(f=e+(n-e)*(this.xmin-t)/(i-t),l=this.xmin),s?(t=l,e=f,s=this._regioncode(t,e)):(i=l,n=f,r=this._regioncode(i,n))}}_clipInfinite(t,e,i,n,s,r){let o=Array.from(e),l;if((l=this._project(o[0],o[1],i,n))&&o.unshift(l[0],l[1]),(l=this._project(o[o.length-2],o[o.length-1],s,r))&&o.push(l[0],l[1]),o=this._clipFinite(t,o))for(let f=0,u=o.length,a,c=this._edgecode(o[u-2],o[u-1]);f<u;f+=2)a=c,c=this._edgecode(o[f],o[f+1]),a&&c&&(f=this._edge(t,a,c,o,f),u=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,e,i,n,s){for(;e!==i;){let r,o;switch(e){case 5:e=4;continue;case 4:e=6,r=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,r=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,r=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,r=this.xmin,o=this.ymin;break}(n[s]!==r||n[s+1]!==o)&&this.contains(t,r,o)&&(n.splice(s,0,r,o),s+=2)}return s}_project(t,e,i,n){let s=1/0,r,o,l;if(n<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/n)<s&&(l=this.ymin,o=t+(s=r)*i)}else if(n>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/n)<s&&(l=this.ymax,o=t+(s=r)*i)}if(i>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/i)<s&&(o=this.xmax,l=e+(s=r)*n)}else if(i<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/i)<s&&(o=this.xmin,l=e+(s=r)*n)}return[o,l]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){const i=(e+2)%t.length,n=(e+4)%t.length;(t[e]===t[i]&&t[i]===t[n]||t[e+1]===t[i+1]&&t[i+1]===t[n+1])&&(t.splice(i,2),e-=2)}t.length||(t=null)}return t}}const Ne=2*Math.PI,tt=Math.pow;function Ce(h){return h[0]}function Ee(h){return h[1]}function Re(h){const{triangles:t,coords:e}=h;for(let i=0;i<t.length;i+=3){const n=2*t[i],s=2*t[i+1],r=2*t[i+2];if((e[r]-e[n])*(e[s+1]-e[n+1])-(e[s]-e[n])*(e[r+1]-e[n+1])>1e-10)return!1}return!0}function $e(h,t,e){return[h+Math.sin(h+t)*e,t+Math.cos(h-t)*e]}class jt{static from(t,e=Ce,i=Ee,n){return new jt("length"in t?ze(t,e,i,n):Float64Array.from(Oe(t,e,i,n)))}constructor(t){this._delaunator=new mt(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&Re(t)){this.collinear=Int32Array.from({length:e.length/2},(c,d)=>d).sort((c,d)=>e[2*c]-e[2*d]||e[2*c+1]-e[2*d+1]);const l=this.collinear[0],f=this.collinear[this.collinear.length-1],u=[e[2*l],e[2*l+1],e[2*f],e[2*f+1]],a=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let c=0,d=e.length/2;c<d;++c){const m=$e(e[2*c],e[2*c+1],a);e[2*c]=m[0],e[2*c+1]=m[1]}this._delaunator=new mt(e)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let l=0,f=i.length;l<f;++l){const u=s[l%3===2?l-2:l+1];(i[l]===-1||r[u]===-1)&&(r[u]=l)}for(let l=0,f=n.length;l<f;++l)o[n[l]]=l;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],r[n[0]]=1,n.length===2&&(r[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(t){return new Ie(this,t)}*neighbors(t){const{inedges:e,hull:i,_hullIndex:n,halfedges:s,triangles:r,collinear:o}=this;if(o){const a=o.indexOf(t);a>0&&(yield o[a-1]),a<o.length-1&&(yield o[a+1]);return}const l=e[t];if(l===-1)return;let f=l,u=-1;do{if(yield u=r[f],f=f%3===2?f-2:f+1,r[f]!==t)return;if(f=s[f],f===-1){const a=i[(n[t]+1)%i.length];a!==u&&(yield a);return}}while(f!==l)}find(t,e,i=0){if(t=+t,t!==t||(e=+e,e!==e))return-1;const n=i;let s;for(;(s=this._step(i,t,e))>=0&&s!==i&&s!==n;)i=s;return s}_step(t,e,i){const{inedges:n,hull:s,_hullIndex:r,halfedges:o,triangles:l,points:f}=this;if(n[t]===-1||!f.length)return(t+1)%(f.length>>1);let u=t,a=tt(e-f[t*2],2)+tt(i-f[t*2+1],2);const c=n[t];let d=c;do{let m=l[d];const p=tt(e-f[m*2],2)+tt(i-f[m*2+1],2);if(p<a&&(a=p,u=m),d=d%3===2?d-2:d+1,l[d]!==t)break;if(d=o[d],d===-1){if(d=s[(r[t]+1)%s.length],d!==m&&tt(e-f[d*2],2)+tt(i-f[d*2+1],2)<a)return d;break}}while(d!==c);return u}render(t){const e=t==null?t=new X:void 0,{points:i,halfedges:n,triangles:s}=this;for(let r=0,o=n.length;r<o;++r){const l=n[r];if(l<r)continue;const f=s[r]*2,u=s[l]*2;t.moveTo(i[f],i[f+1]),t.lineTo(i[u],i[u+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){e===void 0&&(!t||typeof t.moveTo!="function")&&(e=t,t=null),e=e==null?2:+e;const i=t==null?t=new X:void 0,{points:n}=this;for(let s=0,r=n.length;s<r;s+=2){const o=n[s],l=n[s+1];t.moveTo(o+e,l),t.arc(o,l,e,0,Ne)}return i&&i.value()}renderHull(t){const e=t==null?t=new X:void 0,{hull:i,points:n}=this,s=i[0]*2,r=i.length;t.moveTo(n[s],n[s+1]);for(let o=1;o<r;++o){const l=2*i[o];t.lineTo(n[l],n[l+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new wt;return this.renderHull(t),t.value()}renderTriangle(t,e){const i=e==null?e=new X:void 0,{points:n,triangles:s}=this,r=s[t*=3]*2,o=s[t+1]*2,l=s[t+2]*2;return e.moveTo(n[r],n[r+1]),e.lineTo(n[o],n[o+1]),e.lineTo(n[l],n[l+1]),e.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,i=t.length/3;e<i;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new wt;return this.renderTriangle(t,e),e.value()}}function ze(h,t,e,i){const n=h.length,s=new Float64Array(n*2);for(let r=0;r<n;++r){const o=h[r];s[r*2]=t.call(i,o,r,h),s[r*2+1]=e.call(i,o,r,h)}return s}function*Oe(h,t,e,i){let n=0;for(const s of h)yield t.call(i,s,n,h),yield e.call(i,s,n,h),++n}const Ue=(h,t)=>{let e=h[0],i=h[1],n=!1;for(let s=0,r=t.length-1;s<t.length;r=s++){let o=t[s][0],l=t[s][1],f=t[r][0],u=t[r][1];l>i!=u>i&&e<(f-o)*(i-l)/(u-l)+o&&(n=!n)}return n},Le=({count:h=200,cells:t=[]})=>{const e=A.useRef(null),{clusterMetrics:i}=$t(),n=A.useRef({}),s=A.useMemo(()=>Array.from({length:h}).map(()=>({active:!1,pos:new D,vel:new D,life:0,maxLife:1,color:new Wt})),[h]);return pt((r,o)=>{if(!e.current)return;const l=new Ft;let f=0;s.forEach(u=>{if(u.active)if(u.life-=o*1.5,u.life<=0)u.active=!1;else{u.pos.addScaledVector(u.vel,o),l.position.copy(u.pos);const a=u.life/u.maxLife*.15;l.scale.set(a,a,a),l.updateMatrix(),e.current.setMatrixAt(f,l.matrix),e.current.setColorAt(f,u.color),f++}}),l.scale.set(0,0,0);for(let u=f;u<h;u++)l.updateMatrix(),e.current.setMatrixAt(u,l.matrix);e.current.instanceMatrix.needsUpdate=!0,e.current.instanceColor&&(e.current.instanceColor.needsUpdate=!0)}),A.useEffect(()=>{i.forEach(r=>{const o=n.current[r.name]||0;if(r.activeUnits>o){const l=t.find(u=>u.name===r.name),f=l?new D(l.centroid[0],l.centroid[1],.2):new D(0,0,.5);for(let u=0;u<5;u++){const a=s.find(c=>!c.active);a&&(a.active=!0,a.life=1,a.maxLife=1,a.color.set(rt[r.name]||"#ffffff"),a.pos.copy(f),a.vel.set((Math.random()-.5)*2,(Math.random()-.5)*2,Math.random()*2+.5))}}n.current[r.name]=r.activeUnits})},[i,s,t]),b.jsxs("instancedMesh",{ref:e,args:[void 0,void 0,h],children:[b.jsx("sphereGeometry",{args:[1,6,6]}),b.jsx("meshStandardMaterial",{emissiveIntensity:10,transparent:!0})]})},Fe=({points:h,color:t,label:e,active:i,onHover:n,count:s,activeZone:r,onPointerEnter:o,onPointerLeave:l,centroid:f})=>{const u=A.useRef(null),a=A.useMemo(()=>{const m=new oe;return!h||h.length===0||(h.forEach((p,y)=>{y===0?m.moveTo(p[0],p[1]):m.lineTo(p[0],p[1])}),m.closePath()),m},[h]),c=A.useMemo(()=>{if(!h||h.length===0)return[];const m=h.map(p=>new D(p[0],p[1],.01));return m.push(new D(h[0][0],h[0][1],.01)),m},[h]);if(pt(m=>{if(u.current){const p=i?.6:0;u.current.position.z=ae.lerp(u.current.position.z,p,.15);const y=u.current.material;if(i)y.opacity=.85,y.emissiveIntensity=4;else{const g=Math.sin(m.clock.elapsedTime*1.5+e.length)*.05+.2;y.opacity=g,y.emissiveIntensity=g*2}}}),!h||h.length===0)return null;const d=dt[e]||e;return b.jsxs("group",{children:[b.jsxs("mesh",{ref:u,onPointerOver:m=>{m.stopPropagation(),n(e)},onPointerOut:m=>{m.stopPropagation(),n(null)},onPointerEnter:m=>{m.stopPropagation(),o(e)},onPointerLeave:m=>{m.stopPropagation(),l(null)},children:[b.jsx("shapeGeometry",{args:[a]}),b.jsx("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:.5,transparent:!0,opacity:.2,side:Ot}),b.jsx("group",{children:c.length>0&&b.jsxs("line",{children:[b.jsx("bufferGeometry",{attach:"geometry",onUpdate:m=>m.setFromPoints(c)}),b.jsx("lineBasicMaterial",{attach:"material",color:t,transparent:!0,opacity:i?.8:.2,depthWrite:!1,blending:le})]})})]}),f&&b.jsxs("group",{position:[f[0],f[1],.2],children:[b.jsx(xt,{position:[0,.4,0],fontSize:.25,color:"white",anchorX:"center",anchorY:"middle",fillOpacity:.9,children:d.toUpperCase()}),b.jsx(xt,{position:[0,-.1,0],fontSize:.5,color:t,anchorX:"center",anchorY:"middle",fillOpacity:.8,children:Math.round(s).toLocaleString()}),b.jsx(xt,{position:[0,-.5,0],fontSize:.15,color:"white",anchorX:"center",anchorY:"middle",fillOpacity:.4,children:"EVENTS"})]}),(i||r===e)&&b.jsx(Dt,{position:[0,0,1.2],center:!0,pointerEvents:"none",children:b.jsxs("div",{className:zt("px-3 py-1.5 rounded-sm backdrop-blur-xl border transition-all duration-300",r===e?"border-cyan-400 bg-void/60 shadow-[0_0_20px_rgba(34,211,238,0.2)]":"border-white/10 bg-black/80"),children:[b.jsx("div",{className:"text-[11px] font-orbitron font-black text-white uppercase tracking-widest whitespace-nowrap",children:dt[e]||e}),b.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[b.jsx("div",{className:"h-1 flex-1 bg-white/5 rounded-full overflow-hidden",children:b.jsx("div",{className:"h-full bg-cyan-400/50",style:{width:`${Math.min(100,s/5)}%`}})}),b.jsxs("div",{className:"text-[8px] text-cyan-400 font-mono-data uppercase",children:[Math.round(s)," UNIT"]})]})]})})]})},We=({agents:h})=>{const t=A.useRef(null),e=A.useMemo(()=>new Ft,[]);return pt((i,n)=>{t.current&&(h.forEach((s,r)=>{e.position.set(s.position[0],s.position[1],s.position[2]);const o=(s.isActive?1.4:1)+Math.sin(i.clock.elapsedTime*4+r)*.1;e.scale.set(o,o,o),e.updateMatrix(),t.current.setMatrixAt(r,e.matrix),t.current.setColorAt(r,new Wt(s.themeColor))}),t.current.instanceMatrix.needsUpdate=!0,t.current.instanceColor&&(t.current.instanceColor.needsUpdate=!0))}),b.jsxs("group",{children:[b.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,Math.max(1,h.length)],children:[b.jsx("sphereGeometry",{args:[.07,12,12]}),b.jsx("meshStandardMaterial",{emissiveIntensity:2,transparent:!0,opacity:.9})]}),h.map(i=>(i.isActive||i.lastAction)&&b.jsx(Dt,{position:i.position,center:!0,distanceFactor:15,pointerEvents:"none",children:b.jsx("div",{className:zt("px-2 py-0.5 rounded-[1px] text-[7px] font-orbitron font-black uppercase whitespace-nowrap border backdrop-blur-md shadow-lg transition-transform duration-300",i.lastAction?"bg-cyan-500 border-white text-white scale-110":"bg-black/90 border-white/20 text-white/80"),children:i.lastAction||i.name.split(" ")[0]})},i.id))]})};class Ve extends Jt.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,e){console.error("Voronoi Component Crash:",t,e)}render(){return this.state.hasError?b.jsxs("div",{className:"w-full h-full bg-black flex flex-col items-center justify-center border border-red-500/50 p-4 relative z-50",children:[b.jsx(_t,{className:"text-red-500 mb-2 animate-pulse",size:32}),b.jsx("h3",{className:"text-white font-orbitron text-sm uppercase text-center mb-1 tracking-widest",children:"Visual System Failure"}),b.jsx("p",{className:"text-red-400 font-mono text-[10px] max-w-[200px] text-center mb-4 bg-red-900/20 p-2 rounded",children:this.state.error?.message||"Unknown WebGL Error"}),b.jsx("button",{className:"px-3 py-1 bg-red-500/20 border border-red-500 text-red-500 text-[10px] font-orbitron uppercase hover:bg-red-500/40 transition-colors cursor-pointer",onClick:()=>window.location.reload(),children:"Reboot System"}),b.jsx("span",{className:"absolute bottom-2 right-2 text-[8px] text-gray-600 font-mono text-center",children:"ERR_CODE: VORONOI_CRASH_0x1"})]}):this.props.children}}const Ye=()=>b.jsx(Ve,{children:b.jsx(De,{})}),De=()=>{const{clusterMetrics:h,selectableUsers:t,currentUser:e,logs:i}=$t(),[n,s]=A.useState(null),[r,o]=A.useState(null),l=A.useMemo(()=>h.filter(c=>c.activeUnits>0&&!isNaN(c.activeUnits)),[h]),f=A.useMemo(()=>{const c=l.length;if(c===0)return[];const d=16.5,m=12.5,p=l.map((y,g)=>{const _=g/c*Math.PI*2,w=3.8+Math.sin(g*1.8)*1.2,M=Math.cos(_)*w+Math.sin(g*12)*.5,S=Math.sin(_)*w+Math.cos(g*8)*.5;return isNaN(M)||isNaN(S)?[0,0]:[M,S]});if(c<2)return l.map(y=>({name:y.name,points:[[-6,-5],[6,-5],[6,5],[-6,5]],centroid:[0,0],color:rt[y.name]||"#ffffff",intensity:y.activeUnits}));try{const g=jt.from(p).voronoi([-d/2,-m/2,d/2,m/2]);return l.map((_,w)=>{const M=Array.from(g.cellPolygon(w)||[]);if(M.length===0)return null;let S=0,j=0;return M.forEach(C=>{S+=C[0],j+=C[1]}),{name:_.name,points:M,centroid:[S/M.length,j/M.length],color:rt[_.name]||"#ffffff",intensity:_.activeUnits}}).filter(Boolean)}catch(y){return console.warn("Voronoi Fallback due to error:",y),l.map((g,_)=>{const w=_/c*Math.PI*2,M=(_+1)/c*Math.PI*2,S=8;return{name:g.name,points:[[0,0],[Math.cos(w)*S,Math.sin(w)*S],[Math.cos(M)*S,Math.sin(M)*S]],centroid:[Math.cos(w+(M-w)/2)*S/2,Math.sin(w+(M-w)/2)*S/2],color:rt[g.name]||"#ffffff",intensity:g.activeUnits}})}},[l]),u=A.useMemo(()=>t.map((c,d)=>{if(!c||!c.id||typeof c.id!="string")return null;const m=c.id.trim(),p=c.stats&&Object.entries(c.stats).sort((j,C)=>C[1]-j[1])[0]?.[0]||"Science",y=f.find(j=>j.name===p);if(!y)return null;const g=d*42.42;let _=y.centroid[0]+Math.sin(g)*1.5,w=y.centroid[1]+Math.cos(g)*1.5;Ue([_,w],y.points)||(_=y.centroid[0]+Math.sin(g)*.5,w=y.centroid[1]+Math.cos(g)*.5);const M=i.find(j=>j.userId===c.name),S=M&&Date.now()-M.timestamp<2500;return{id:m,name:c.name,position:[_,w,.15],themeColor:y.color,isActive:e.id.trim()===m,lastAction:S?M.action:null}}).filter(Boolean),[t,f,e.id,i]),a=l.find(c=>c.name===n);return h.length===0?b.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center",children:b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[b.jsx(_t,{className:"text-cyan-500/20 animate-pulse",size:40}),b.jsx("span",{className:"text-[10px] font-orbitron font-black text-white/20 uppercase tracking-[.8em]",children:"CALIBRATING_SYSTEM"})]})}):l.length===0?b.jsxs("div",{className:"w-full h-full bg-void border border-white/5 flex flex-col items-center justify-center gap-4",children:[b.jsx("div",{className:"text-cyan-500/10",children:b.jsx(_t,{size:60,strokeWidth:.5})}),b.jsx("span",{className:"text-white/20 text-[9px] font-orbitron font-black uppercase tracking-widest",children:"Awaiting Active Nodes..."})]}):b.jsxs("div",{className:"w-full h-full relative overflow-hidden rounded-xl border border-white/5 bg-black/20",children:[b.jsxs("div",{className:"absolute top-6 right-8 z-10 text-right pointer-events-none",children:[b.jsx("div",{className:"text-[18px] font-orbitron font-black text-white tabular-nums tracking-tighter drop-shadow-lg",children:a?a.activeUnits.toLocaleString():"---"}),b.jsx("div",{className:"text-[7px] text-cyan-400/50 uppercase font-orbitron font-black tracking-widest mt-0.5",children:a?`${dt[a.name]||a.name} load`:"SCANNING_CLUSTER"})]}),b.jsxs(ee,{gl:{antialias:!1,alpha:!0,powerPreference:"high-performance"},camera:{position:[0,-10,16],fov:32},children:[b.jsx(ne,{enableZoom:!1,maxPolarAngle:Math.PI/2.2,minPolarAngle:Math.PI/4,enablePan:!1}),b.jsx("ambientLight",{intensity:1.5}),b.jsx("pointLight",{position:[0,10,10],intensity:4,color:"#3b82f6"}),b.jsx(ie,{speed:1.5,rotationIntensity:.05,floatIntensity:.5,children:b.jsxs("group",{rotation:[-Math.PI/12,0,0],children:[f.map(c=>c&&b.jsx(Fe,{...c,active:n===c.name,onHover:s,activeZone:r,onPointerEnter:o,onPointerLeave:o,label:c.name,count:c.intensity},c.name)),b.jsx(We,{agents:u}),b.jsx(Le,{cells:f}),b.jsx("gridHelper",{args:[30,20],rotation:[Math.PI/2,0,0],position:[0,0,-.2],children:b.jsx("meshBasicMaterial",{attach:"material",color:"#22d3ee",transparent:!0,opacity:.02})}),b.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,0,-.3],children:[b.jsx("ringGeometry",{args:[0,15,6,1]}),b.jsx("meshBasicMaterial",{color:"#22d3ee",transparent:!0,opacity:.01,wireframe:!0})]})]})})]}),b.jsxs("div",{className:"absolute bottom-6 left-6 right-6 flex justify-between items-end pointer-events-none",children:[b.jsx("div",{className:"flex gap-5",children:l.slice(0,6).map(c=>b.jsxs("div",{className:"group/item flex flex-col gap-1.5 transition-opacity duration-300",style:{opacity:!n||n===c.name?1:.2},children:[b.jsx("div",{className:"h-0.5 w-8 bg-white/5 rounded-full overflow-hidden",children:b.jsx("div",{className:"h-full",style:{width:"100%",backgroundColor:rt[c.name]}})}),b.jsx("span",{className:"text-[7px] font-orbitron font-black text-white/30 uppercase tracking-tighter",children:dt[c.name]?.slice(0,4)||c.name.slice(0,4)})]},c.name))}),b.jsx("div",{className:"flex flex-col items-end gap-2",children:b.jsx("div",{className:"px-2 py-1 bg-cyan-400/5 border border-cyan-400/20 rounded-[1px] backdrop-blur-md",children:b.jsx("span",{className:"text-[8px] font-orbitron font-black text-cyan-400 uppercase tracking-[0.2em] animate-pulse",children:"Link_Status: Secure"})})})]}),b.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-[0.03] bg-[radial-gradient(#fff_1px,transparent_1px)] bg-[size:20px_20px]"})]})};export{Ye as StrategicVoronoiMap};
