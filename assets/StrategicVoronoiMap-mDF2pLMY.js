import{r as M,dw as Gt,dx as Kt,dy as mt,dg as Zt,O as $t,b as it,V as Xt,ad as Rt,ab as Ft,dl as Yt,dz as Tt,dp as w,dA as qt,dB as Qt,dC as Jt,dD as te,dq as ft,dE as ee,dF as ne,dG as se,cM as ie}from"./index-EF4sIdtj.js";const rt=new it,vt=new it,re=new it,kt=new Xt;function oe(l,t,e){const s=rt.setFromMatrixPosition(l.matrixWorld);s.project(t);const n=e.width/2,i=e.height/2;return[s.x*n+n,-(s.y*i)+i]}function le(l,t){const e=rt.setFromMatrixPosition(l.matrixWorld),s=vt.setFromMatrixPosition(t.matrixWorld),n=e.sub(s),i=t.getWorldDirection(re);return n.angleTo(i)>Math.PI/2}function ae(l,t,e,s){const n=rt.setFromMatrixPosition(l.matrixWorld),i=n.clone();i.project(t),kt.set(i.x,i.y),e.setFromCamera(kt,t);const r=e.intersectObjects(s,!0);if(r.length){const o=r[0].distance;return n.distanceTo(e.ray.origin)<o}return!0}function ce(l,t){if(t instanceof Ft)return t.zoom;if(t instanceof Rt){const e=rt.setFromMatrixPosition(l.matrixWorld),s=vt.setFromMatrixPosition(t.matrixWorld),n=t.fov*Math.PI/180,i=e.distanceTo(s);return 1/(2*Math.tan(n/2)*i)}else return 1}function he(l,t,e){if(t instanceof Rt||t instanceof Ft){const s=rt.setFromMatrixPosition(l.matrixWorld),n=vt.setFromMatrixPosition(t.matrixWorld),i=s.distanceTo(n),r=(e[1]-e[0])/(t.far-t.near),o=e[1]-r*t.far;return Math.round(r*i+o)}}const yt=l=>Math.abs(l)<1e-10?0:l;function Ot(l,t,e=""){let s="matrix3d(";for(let n=0;n!==16;n++)s+=yt(t[n]*l.elements[n])+(n!==15?",":")");return e+s}const ue=(l=>t=>Ot(t,l))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),fe=(l=>(t,e)=>Ot(t,l(e),"translate(-50%,-50%)"))(l=>[1/l,1/l,1/l,1,-1/l,-1/l,-1/l,-1,1/l,1/l,1/l,1,1,1,1,1]);function de(l){return l&&typeof l=="object"&&"current"in l}const bt=M.forwardRef(({children:l,eps:t=.001,style:e,className:s,prepend:n,center:i,fullscreen:r,portal:o,distanceFactor:a,sprite:h=!1,transform:f=!1,occlude:c,onOcclude:u,castShadow:d,receiveShadow:y,material:p,geometry:g,zIndexRange:m=[16777271,0],calculatePosition:b=oe,as:_="div",wrapperClass:P,pointerEvents:A="auto",...j},C)=>{const{gl:T,camera:x,scene:S,size:v,raycaster:E,events:$,viewport:F}=Gt(),[N]=M.useState(()=>document.createElement(_)),k=M.useRef(null),I=M.useRef(null),U=M.useRef(0),O=M.useRef([0,0]),H=M.useRef(null),et=M.useRef(null),Y=o?.current||$.connected||T.domElement.parentNode,B=M.useRef(null),lt=M.useRef(!1),at=M.useMemo(()=>c&&c!=="blending"||Array.isArray(c)&&c.length&&de(c[0]),[c]);M.useLayoutEffect(()=>{const W=T.domElement;c&&c==="blending"?(W.style.zIndex=`${Math.floor(m[0]/2)}`,W.style.position="absolute",W.style.pointerEvents="none"):(W.style.zIndex=null,W.style.position=null,W.style.pointerEvents=null)},[c]),M.useLayoutEffect(()=>{if(I.current){const W=k.current=Kt.createRoot(N);if(S.updateMatrixWorld(),f)N.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const R=b(I.current,x,v);N.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${R[0]}px,${R[1]}px,0);transform-origin:0 0;`}return Y&&(n?Y.prepend(N):Y.appendChild(N)),()=>{Y&&Y.removeChild(N),W.unmount()}}},[Y,f]),M.useLayoutEffect(()=>{P&&(N.className=P)},[P]);const Mt=M.useMemo(()=>f?{position:"absolute",top:0,left:0,width:v.width,height:v.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:i?"translate3d(-50%,-50%,0)":"none",...r&&{top:-v.height/2,left:-v.width/2,width:v.width,height:v.height},...e},[e,i,r,v,f]),Ut=M.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);M.useLayoutEffect(()=>{if(lt.current=!1,f){var W;(W=k.current)==null||W.render(M.createElement("div",{ref:H,style:Mt},M.createElement("div",{ref:et,style:Ut},M.createElement("div",{ref:C,className:s,style:e,children:l}))))}else{var R;(R=k.current)==null||R.render(M.createElement("div",{ref:C,style:Mt,className:s,children:l}))}});const q=M.useRef(!0);mt(W=>{if(I.current){x.updateMatrixWorld(),I.current.updateWorldMatrix(!0,!1);const R=f?O.current:b(I.current,x,v);if(f||Math.abs(U.current-x.zoom)>t||Math.abs(O.current[0]-R[0])>t||Math.abs(O.current[1]-R[1])>t){const G=le(I.current,x);let D=!1;at&&(Array.isArray(c)?D=c.map(K=>K.current):c!=="blending"&&(D=[S]));const nt=q.current;if(D){const K=ae(I.current,x,E,D);q.current=K&&!G}else q.current=!G;nt!==q.current&&(u?u(!q.current):N.style.display=q.current?"block":"none");const ct=Math.floor(m[0]/2),zt=c?at?[m[0],ct]:[ct-1,0]:m;if(N.style.zIndex=`${he(I.current,x,zt)}`,f){const[K,St]=[v.width/2,v.height/2],gt=x.projectionMatrix.elements[5]*St,{isOrthographicCamera:Pt,top:Lt,left:Wt,bottom:Ht,right:Dt}=x,Vt=ue(x.matrixWorldInverse),Bt=Pt?`scale(${gt})translate(${yt(-(Dt+Wt)/2)}px,${yt((Lt+Ht)/2)}px)`:`translateZ(${gt}px)`;let Z=I.current.matrixWorld;h&&(Z=x.matrixWorldInverse.clone().transpose().copyPosition(Z).scale(I.current.scale),Z.elements[3]=Z.elements[7]=Z.elements[11]=0,Z.elements[15]=1),N.style.width=v.width+"px",N.style.height=v.height+"px",N.style.perspective=Pt?"":`${gt}px`,H.current&&et.current&&(H.current.style.transform=`${Bt}${Vt}translate(${K}px,${St}px)`,et.current.style.transform=fe(Z,1/((a||10)/400)))}else{const K=a===void 0?1:ce(I.current,x)*a;N.style.transform=`translate3d(${R[0]}px,${R[1]}px,0) scale(${K})`}O.current=R,U.current=x.zoom}}if(!at&&B.current&&!lt.current)if(f){if(H.current){const R=H.current.children[0];if(R!=null&&R.clientWidth&&R!=null&&R.clientHeight){const{isOrthographicCamera:G}=x;if(G||g)j.scale&&(Array.isArray(j.scale)?j.scale instanceof it?B.current.scale.copy(j.scale.clone().divideScalar(1)):B.current.scale.set(1/j.scale[0],1/j.scale[1],1/j.scale[2]):B.current.scale.setScalar(1/j.scale));else{const D=(a||10)/400,nt=R.clientWidth*D,ct=R.clientHeight*D;B.current.scale.set(nt,ct,1)}lt.current=!0}}}else{const R=N.children[0];if(R!=null&&R.clientWidth&&R!=null&&R.clientHeight){const G=1/F.factor,D=R.clientWidth*G,nt=R.clientHeight*G;B.current.scale.set(D,nt,1),lt.current=!0}B.current.lookAt(W.camera.position)}});const jt=M.useMemo(()=>({vertexShader:f?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[f]);return M.createElement("group",Zt({},j,{ref:I}),c&&!at&&M.createElement("mesh",{castShadow:d,receiveShadow:y,ref:B},g||M.createElement("planeGeometry",null),p||M.createElement("shaderMaterial",{side:$t,vertexShader:jt.vertexShader,fragmentShader:jt.fragmentShader})))}),V=11102230246251565e-32,z=134217729,me=(3+8*V)*V;function pt(l,t,e,s,n){let i,r,o,a,h=t[0],f=s[0],c=0,u=0;f>h==f>-h?(i=h,h=t[++c]):(i=f,f=s[++u]);let d=0;if(c<l&&u<e)for(f>h==f>-h?(r=h+i,o=i-(r-h),h=t[++c]):(r=f+i,o=i-(r-f),f=s[++u]),i=r,o!==0&&(n[d++]=o);c<l&&u<e;)f>h==f>-h?(r=i+h,a=r-i,o=i-(r-a)+(h-a),h=t[++c]):(r=i+f,a=r-i,o=i-(r-a)+(f-a),f=s[++u]),i=r,o!==0&&(n[d++]=o);for(;c<l;)r=i+h,a=r-i,o=i-(r-a)+(h-a),h=t[++c],i=r,o!==0&&(n[d++]=o);for(;u<e;)r=i+f,a=r-i,o=i-(r-a)+(f-a),f=s[++u],i=r,o!==0&&(n[d++]=o);return(i!==0||d===0)&&(n[d++]=i),d}function ge(l,t){let e=t[0];for(let s=1;s<l;s++)e+=t[s];return e}function ot(l){return new Float64Array(l)}const pe=(3+16*V)*V,xe=(2+12*V)*V,ye=(9+64*V)*V*V,Q=ot(4),At=ot(8),Et=ot(12),It=ot(16),L=ot(4);function be(l,t,e,s,n,i,r){let o,a,h,f,c,u,d,y,p,g,m,b,_,P,A,j,C,T;const x=l-n,S=e-n,v=t-i,E=s-i;P=x*E,u=z*x,d=u-(u-x),y=x-d,u=z*E,p=u-(u-E),g=E-p,A=y*g-(P-d*p-y*p-d*g),j=v*S,u=z*v,d=u-(u-v),y=v-d,u=z*S,p=u-(u-S),g=S-p,C=y*g-(j-d*p-y*p-d*g),m=A-C,c=A-m,Q[0]=A-(m+c)+(c-C),b=P+m,c=b-P,_=P-(b-c)+(m-c),m=_-j,c=_-m,Q[1]=_-(m+c)+(c-j),T=b+m,c=T-b,Q[2]=b-(T-c)+(m-c),Q[3]=T;let $=ge(4,Q),F=xe*r;if($>=F||-$>=F||(c=l-x,o=l-(x+c)+(c-n),c=e-S,h=e-(S+c)+(c-n),c=t-v,a=t-(v+c)+(c-i),c=s-E,f=s-(E+c)+(c-i),o===0&&a===0&&h===0&&f===0)||(F=ye*r+me*Math.abs($),$+=x*f+E*o-(v*h+S*a),$>=F||-$>=F))return $;P=o*E,u=z*o,d=u-(u-o),y=o-d,u=z*E,p=u-(u-E),g=E-p,A=y*g-(P-d*p-y*p-d*g),j=a*S,u=z*a,d=u-(u-a),y=a-d,u=z*S,p=u-(u-S),g=S-p,C=y*g-(j-d*p-y*p-d*g),m=A-C,c=A-m,L[0]=A-(m+c)+(c-C),b=P+m,c=b-P,_=P-(b-c)+(m-c),m=_-j,c=_-m,L[1]=_-(m+c)+(c-j),T=b+m,c=T-b,L[2]=b-(T-c)+(m-c),L[3]=T;const N=pt(4,Q,4,L,At);P=x*f,u=z*x,d=u-(u-x),y=x-d,u=z*f,p=u-(u-f),g=f-p,A=y*g-(P-d*p-y*p-d*g),j=v*h,u=z*v,d=u-(u-v),y=v-d,u=z*h,p=u-(u-h),g=h-p,C=y*g-(j-d*p-y*p-d*g),m=A-C,c=A-m,L[0]=A-(m+c)+(c-C),b=P+m,c=b-P,_=P-(b-c)+(m-c),m=_-j,c=_-m,L[1]=_-(m+c)+(c-j),T=b+m,c=T-b,L[2]=b-(T-c)+(m-c),L[3]=T;const k=pt(N,At,4,L,Et);P=o*f,u=z*o,d=u-(u-o),y=o-d,u=z*f,p=u-(u-f),g=f-p,A=y*g-(P-d*p-y*p-d*g),j=a*h,u=z*a,d=u-(u-a),y=a-d,u=z*h,p=u-(u-h),g=h-p,C=y*g-(j-d*p-y*p-d*g),m=A-C,c=A-m,L[0]=A-(m+c)+(c-C),b=P+m,c=b-P,_=P-(b-c)+(m-c),m=_-j,c=_-m,L[1]=_-(m+c)+(c-j),T=b+m,c=T-b,L[2]=b-(T-c)+(m-c),L[3]=T;const I=pt(k,Et,4,L,It);return It[I-1]}function ht(l,t,e,s,n,i){const r=(t-i)*(e-n),o=(l-n)*(s-i),a=r-o,h=Math.abs(r+o);return Math.abs(a)>=pe*h?a:-be(l,t,e,s,n,i,h)}const Ct=Math.pow(2,-52),ut=new Uint32Array(512);class dt{static from(t,e=je,s=Se){const n=t.length,i=new Float64Array(n*2);for(let r=0;r<n;r++){const o=t[r];i[2*r]=e(o),i[2*r+1]=s(o)}return new dt(i)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const s=Math.max(2*e-5,0);this._triangles=new Uint32Array(s*3),this._halfedges=new Int32Array(s*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:s,_hullTri:n,_hullHash:i}=this,r=t.length>>1;let o=1/0,a=1/0,h=-1/0,f=-1/0;for(let x=0;x<r;x++){const S=t[2*x],v=t[2*x+1];S<o&&(o=S),v<a&&(a=v),S>h&&(h=S),v>f&&(f=v),this._ids[x]=x}const c=(o+h)/2,u=(a+f)/2;let d,y,p;for(let x=0,S=1/0;x<r;x++){const v=xt(c,u,t[2*x],t[2*x+1]);v<S&&(d=x,S=v)}const g=t[2*d],m=t[2*d+1];for(let x=0,S=1/0;x<r;x++){if(x===d)continue;const v=xt(g,m,t[2*x],t[2*x+1]);v<S&&v>0&&(y=x,S=v)}let b=t[2*y],_=t[2*y+1],P=1/0;for(let x=0;x<r;x++){if(x===d||x===y)continue;const S=we(g,m,b,_,t[2*x],t[2*x+1]);S<P&&(p=x,P=S)}let A=t[2*p],j=t[2*p+1];if(P===1/0){for(let v=0;v<r;v++)this._dists[v]=t[2*v]-t[0]||t[2*v+1]-t[1];tt(this._ids,this._dists,0,r-1);const x=new Uint32Array(r);let S=0;for(let v=0,E=-1/0;v<r;v++){const $=this._ids[v],F=this._dists[$];F>E&&(x[S++]=$,E=F)}this.hull=x.subarray(0,S),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ht(g,m,b,_,A,j)<0){const x=y,S=b,v=_;y=p,b=A,_=j,p=x,A=S,j=v}const C=Me(g,m,b,_,A,j);this._cx=C.x,this._cy=C.y;for(let x=0;x<r;x++)this._dists[x]=xt(t[2*x],t[2*x+1],C.x,C.y);tt(this._ids,this._dists,0,r-1),this._hullStart=d;let T=3;s[d]=e[p]=y,s[y]=e[d]=p,s[p]=e[y]=d,n[d]=0,n[y]=1,n[p]=2,i.fill(-1),i[this._hashKey(g,m)]=d,i[this._hashKey(b,_)]=y,i[this._hashKey(A,j)]=p,this.trianglesLen=0,this._addTriangle(d,y,p,-1,-1,-1);for(let x=0,S,v;x<this._ids.length;x++){const E=this._ids[x],$=t[2*E],F=t[2*E+1];if(x>0&&Math.abs($-S)<=Ct&&Math.abs(F-v)<=Ct||(S=$,v=F,E===d||E===y||E===p))continue;let N=0;for(let H=0,et=this._hashKey($,F);H<this._hashSize&&(N=i[(et+H)%this._hashSize],!(N!==-1&&N!==s[N]));H++);N=e[N];let k=N,I;for(;I=s[k],ht($,F,t[2*k],t[2*k+1],t[2*I],t[2*I+1])>=0;)if(k=I,k===N){k=-1;break}if(k===-1)continue;let U=this._addTriangle(k,E,s[k],-1,-1,n[k]);n[E]=this._legalize(U+2),n[k]=U,T++;let O=s[k];for(;I=s[O],ht($,F,t[2*O],t[2*O+1],t[2*I],t[2*I+1])<0;)U=this._addTriangle(O,E,I,n[E],-1,n[O]),n[E]=this._legalize(U+2),s[O]=O,T--,O=I;if(k===N)for(;I=e[k],ht($,F,t[2*I],t[2*I+1],t[2*k],t[2*k+1])<0;)U=this._addTriangle(I,E,k,-1,n[k],n[I]),this._legalize(U+2),n[I]=U,s[k]=k,T--,k=I;this._hullStart=e[E]=k,s[k]=e[O]=E,s[E]=O,i[this._hashKey($,F)]=E,i[this._hashKey(t[2*k],t[2*k+1])]=k}this.hull=new Uint32Array(T);for(let x=0,S=this._hullStart;x<T;x++)this.hull[x]=S,S=s[S];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(_e(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:s,coords:n}=this;let i=0,r=0;for(;;){const o=s[t],a=t-t%3;if(r=a+(t+2)%3,o===-1){if(i===0)break;t=ut[--i];continue}const h=o-o%3,f=a+(t+1)%3,c=h+(o+2)%3,u=e[r],d=e[t],y=e[f],p=e[c];if(ve(n[2*u],n[2*u+1],n[2*d],n[2*d+1],n[2*y],n[2*y+1],n[2*p],n[2*p+1])){e[t]=p,e[o]=u;const m=s[c];if(m===-1){let _=this._hullStart;do{if(this._hullTri[_]===c){this._hullTri[_]=t;break}_=this._hullPrev[_]}while(_!==this._hullStart)}this._link(t,m),this._link(o,s[r]),this._link(r,c);const b=h+(o+1)%3;i<ut.length&&(ut[i++]=b)}else{if(i===0)break;t=ut[--i]}}return r}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,s,n,i,r){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=s,this._link(o,n),this._link(o+1,i),this._link(o+2,r),this.trianglesLen+=3,o}}function _e(l,t){const e=l/(Math.abs(l)+Math.abs(t));return(t>0?3-e:1+e)/4}function xt(l,t,e,s){const n=l-e,i=t-s;return n*n+i*i}function ve(l,t,e,s,n,i,r,o){const a=l-r,h=t-o,f=e-r,c=s-o,u=n-r,d=i-o,y=a*a+h*h,p=f*f+c*c,g=u*u+d*d;return a*(c*g-p*d)-h*(f*g-p*u)+y*(f*d-c*u)<0}function we(l,t,e,s,n,i){const r=e-l,o=s-t,a=n-l,h=i-t,f=r*r+o*o,c=a*a+h*h,u=.5/(r*h-o*a),d=(h*f-o*c)*u,y=(r*c-a*f)*u;return d*d+y*y}function Me(l,t,e,s,n,i){const r=e-l,o=s-t,a=n-l,h=i-t,f=r*r+o*o,c=a*a+h*h,u=.5/(r*h-o*a),d=l+(h*f-o*c)*u,y=t+(r*c-a*f)*u;return{x:d,y}}function tt(l,t,e,s){if(s-e<=20)for(let n=e+1;n<=s;n++){const i=l[n],r=t[i];let o=n-1;for(;o>=e&&t[l[o]]>r;)l[o+1]=l[o--];l[o+1]=i}else{const n=e+s>>1;let i=e+1,r=s;st(l,n,i),t[l[e]]>t[l[s]]&&st(l,e,s),t[l[i]]>t[l[s]]&&st(l,i,s),t[l[e]]>t[l[i]]&&st(l,e,i);const o=l[i],a=t[o];for(;;){do i++;while(t[l[i]]<a);do r--;while(t[l[r]]>a);if(r<i)break;st(l,i,r)}l[e+1]=l[r],l[r]=o,s-i+1>=r-e?(tt(l,t,i,s),tt(l,t,e,r-1)):(tt(l,t,e,r-1),tt(l,t,i,s))}}function st(l,t,e){const s=l[t];l[t]=l[e],l[e]=s}function je(l){return l[0]}function Se(l){return l[1]}const Nt=1e-6;class X{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,s){t=+t,e=+e,s=+s;const n=t+s,i=e;if(s<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${i}`:(Math.abs(this._x1-n)>Nt||Math.abs(this._y1-i)>Nt)&&(this._+="L"+n+","+i),s&&(this._+=`A${s},${s},0,1,1,${t-s},${e}A${s},${s},0,1,1,${this._x1=n},${this._y1=i}`)}rect(t,e,s,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+s}v${+n}h${-s}Z`}value(){return this._||null}}class _t{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Pe{constructor(t,[e,s,n,i]=[0,0,960,500]){if(!((n=+n)>=(e=+e))||!((i=+i)>=(s=+s)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=n,this.xmin=e,this.ymax=i,this.ymin=s,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:s},vectors:n}=this;let i,r;const o=this.circumcenters=this._circumcenters.subarray(0,s.length/3*2);for(let p=0,g=0,m=s.length,b,_;p<m;p+=3,g+=2){const P=s[p]*2,A=s[p+1]*2,j=s[p+2]*2,C=t[P],T=t[P+1],x=t[A],S=t[A+1],v=t[j],E=t[j+1],$=x-C,F=S-T,N=v-C,k=E-T,I=($*k-F*N)*2;if(Math.abs(I)<1e-9){if(i===void 0){i=r=0;for(const O of e)i+=t[O*2],r+=t[O*2+1];i/=e.length,r/=e.length}const U=1e9*Math.sign((i-C)*k-(r-T)*N);b=(C+v)/2-U*k,_=(T+E)/2+U*N}else{const U=1/I,O=$*$+F*F,H=N*N+k*k;b=C+(k*O-F*H)*U,_=T+($*H-N*O)*U}o[g]=b,o[g+1]=_}let a=e[e.length-1],h,f=a*4,c,u=t[2*a],d,y=t[2*a+1];n.fill(0);for(let p=0;p<e.length;++p)a=e[p],h=f,c=u,d=y,f=a*4,u=t[2*a],y=t[2*a+1],n[h+2]=n[f]=d-y,n[h+3]=n[f+1]=u-c}render(t){const e=t==null?t=new X:void 0,{delaunay:{halfedges:s,inedges:n,hull:i},circumcenters:r,vectors:o}=this;if(i.length<=1)return null;for(let f=0,c=s.length;f<c;++f){const u=s[f];if(u<f)continue;const d=Math.floor(f/3)*2,y=Math.floor(u/3)*2,p=r[d],g=r[d+1],m=r[y],b=r[y+1];this._renderSegment(p,g,m,b,t)}let a,h=i[i.length-1];for(let f=0;f<i.length;++f){a=h,h=i[f];const c=Math.floor(n[h]/3)*2,u=r[c],d=r[c+1],y=a*4,p=this._project(u,d,o[y+2],o[y+3]);p&&this._renderSegment(u,d,p[0],p[1],t)}return e&&e.value()}renderBounds(t){const e=t==null?t=new X:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const s=e==null?e=new X:void 0,n=this._clip(t);if(n===null||!n.length)return;e.moveTo(n[0],n[1]);let i=n.length;for(;n[0]===n[i-2]&&n[1]===n[i-1]&&i>1;)i-=2;for(let r=2;r<i;r+=2)(n[r]!==n[r-2]||n[r+1]!==n[r-1])&&e.lineTo(n[r],n[r+1]);return e.closePath(),s&&s.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,s=t.length/2;e<s;++e){const n=this.cellPolygon(e);n&&(n.index=e,yield n)}}cellPolygon(t){const e=new _t;return this.renderCell(t,e),e.value()}_renderSegment(t,e,s,n,i){let r;const o=this._regioncode(t,e),a=this._regioncode(s,n);o===0&&a===0?(i.moveTo(t,e),i.lineTo(s,n)):(r=this._clipSegment(t,e,s,n,o,a))&&(i.moveTo(r[0],r[1]),i.lineTo(r[2],r[3]))}contains(t,e,s){return e=+e,e!==e||(s=+s,s!==s)?!1:this.delaunay._step(t,e,s)===t}*neighbors(t){const e=this._clip(t);if(e)for(const s of this.delaunay.neighbors(t)){const n=this._clip(s);if(n){t:for(let i=0,r=e.length;i<r;i+=2)for(let o=0,a=n.length;o<a;o+=2)if(e[i]===n[o]&&e[i+1]===n[o+1]&&e[(i+2)%r]===n[(o+a-2)%a]&&e[(i+3)%r]===n[(o+a-1)%a]){yield s;break t}}}}_cell(t){const{circumcenters:e,delaunay:{inedges:s,halfedges:n,triangles:i}}=this,r=s[t];if(r===-1)return null;const o=[];let a=r;do{const h=Math.floor(a/3);if(o.push(e[h*2],e[h*2+1]),a=a%3===2?a-2:a+1,i[a]!==t)break;a=n[a]}while(a!==r&&a!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(e===null)return null;const{vectors:s}=this,n=t*4;return this._simplify(s[n]||s[n+1]?this._clipInfinite(t,e,s[n],s[n+1],s[n+2],s[n+3]):this._clipFinite(t,e))}_clipFinite(t,e){const s=e.length;let n=null,i,r,o=e[s-2],a=e[s-1],h,f=this._regioncode(o,a),c,u=0;for(let d=0;d<s;d+=2)if(i=o,r=a,o=e[d],a=e[d+1],h=f,f=this._regioncode(o,a),h===0&&f===0)c=u,u=0,n?n.push(o,a):n=[o,a];else{let y,p,g,m,b;if(h===0){if((y=this._clipSegment(i,r,o,a,h,f))===null)continue;[p,g,m,b]=y}else{if((y=this._clipSegment(o,a,i,r,f,h))===null)continue;[m,b,p,g]=y,c=u,u=this._edgecode(p,g),c&&u&&this._edge(t,c,u,n,n.length),n?n.push(p,g):n=[p,g]}c=u,u=this._edgecode(m,b),c&&u&&this._edge(t,c,u,n,n.length),n?n.push(m,b):n=[m,b]}if(n)c=u,u=this._edgecode(n[0],n[1]),c&&u&&this._edge(t,c,u,n,n.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(t,e,s,n,i,r){const o=i<r;for(o&&([t,e,s,n,i,r]=[s,n,t,e,r,i]);;){if(i===0&&r===0)return o?[s,n,t,e]:[t,e,s,n];if(i&r)return null;let a,h,f=i||r;f&8?(a=t+(s-t)*(this.ymax-e)/(n-e),h=this.ymax):f&4?(a=t+(s-t)*(this.ymin-e)/(n-e),h=this.ymin):f&2?(h=e+(n-e)*(this.xmax-t)/(s-t),a=this.xmax):(h=e+(n-e)*(this.xmin-t)/(s-t),a=this.xmin),i?(t=a,e=h,i=this._regioncode(t,e)):(s=a,n=h,r=this._regioncode(s,n))}}_clipInfinite(t,e,s,n,i,r){let o=Array.from(e),a;if((a=this._project(o[0],o[1],s,n))&&o.unshift(a[0],a[1]),(a=this._project(o[o.length-2],o[o.length-1],i,r))&&o.push(a[0],a[1]),o=this._clipFinite(t,o))for(let h=0,f=o.length,c,u=this._edgecode(o[f-2],o[f-1]);h<f;h+=2)c=u,u=this._edgecode(o[h],o[h+1]),c&&u&&(h=this._edge(t,c,u,o,h),f=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,e,s,n,i){for(;e!==s;){let r,o;switch(e){case 5:e=4;continue;case 4:e=6,r=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,r=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,r=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,r=this.xmin,o=this.ymin;break}(n[i]!==r||n[i+1]!==o)&&this.contains(t,r,o)&&(n.splice(i,0,r,o),i+=2)}return i}_project(t,e,s,n){let i=1/0,r,o,a;if(n<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/n)<i&&(a=this.ymin,o=t+(i=r)*s)}else if(n>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/n)<i&&(a=this.ymax,o=t+(i=r)*s)}if(s>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/s)<i&&(o=this.xmax,a=e+(i=r)*n)}else if(s<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/s)<i&&(o=this.xmin,a=e+(i=r)*n)}return[o,a]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){const s=(e+2)%t.length,n=(e+4)%t.length;(t[e]===t[s]&&t[s]===t[n]||t[e+1]===t[s+1]&&t[s+1]===t[n+1])&&(t.splice(s,2),e-=2)}t.length||(t=null)}return t}}const Te=2*Math.PI,J=Math.pow;function ke(l){return l[0]}function Ae(l){return l[1]}function Ee(l){const{triangles:t,coords:e}=l;for(let s=0;s<t.length;s+=3){const n=2*t[s],i=2*t[s+1],r=2*t[s+2];if((e[r]-e[n])*(e[i+1]-e[n+1])-(e[i]-e[n])*(e[r+1]-e[n+1])>1e-10)return!1}return!0}function Ie(l,t,e){return[l+Math.sin(l+t)*e,t+Math.cos(l-t)*e]}class wt{static from(t,e=ke,s=Ae,n){return new wt("length"in t?Ce(t,e,s,n):Float64Array.from(Ne(t,e,s,n)))}constructor(t){this._delaunator=new dt(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&Ee(t)){this.collinear=Int32Array.from({length:e.length/2},(u,d)=>d).sort((u,d)=>e[2*u]-e[2*d]||e[2*u+1]-e[2*d+1]);const a=this.collinear[0],h=this.collinear[this.collinear.length-1],f=[e[2*a],e[2*a+1],e[2*h],e[2*h+1]],c=1e-8*Math.hypot(f[3]-f[1],f[2]-f[0]);for(let u=0,d=e.length/2;u<d;++u){const y=Ie(e[2*u],e[2*u+1],c);e[2*u]=y[0],e[2*u+1]=y[1]}this._delaunator=new dt(e)}else delete this.collinear;const s=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let a=0,h=s.length;a<h;++a){const f=i[a%3===2?a-2:a+1];(s[a]===-1||r[f]===-1)&&(r[f]=a)}for(let a=0,h=n.length;a<h;++a)o[n[a]]=a;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],r[n[0]]=1,n.length===2&&(r[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(t){return new Pe(this,t)}*neighbors(t){const{inedges:e,hull:s,_hullIndex:n,halfedges:i,triangles:r,collinear:o}=this;if(o){const c=o.indexOf(t);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const a=e[t];if(a===-1)return;let h=a,f=-1;do{if(yield f=r[h],h=h%3===2?h-2:h+1,r[h]!==t)return;if(h=i[h],h===-1){const c=s[(n[t]+1)%s.length];c!==f&&(yield c);return}}while(h!==a)}find(t,e,s=0){if(t=+t,t!==t||(e=+e,e!==e))return-1;const n=s;let i;for(;(i=this._step(s,t,e))>=0&&i!==s&&i!==n;)s=i;return i}_step(t,e,s){const{inedges:n,hull:i,_hullIndex:r,halfedges:o,triangles:a,points:h}=this;if(n[t]===-1||!h.length)return(t+1)%(h.length>>1);let f=t,c=J(e-h[t*2],2)+J(s-h[t*2+1],2);const u=n[t];let d=u;do{let y=a[d];const p=J(e-h[y*2],2)+J(s-h[y*2+1],2);if(p<c&&(c=p,f=y),d=d%3===2?d-2:d+1,a[d]!==t)break;if(d=o[d],d===-1){if(d=i[(r[t]+1)%i.length],d!==y&&J(e-h[d*2],2)+J(s-h[d*2+1],2)<c)return d;break}}while(d!==u);return f}render(t){const e=t==null?t=new X:void 0,{points:s,halfedges:n,triangles:i}=this;for(let r=0,o=n.length;r<o;++r){const a=n[r];if(a<r)continue;const h=i[r]*2,f=i[a]*2;t.moveTo(s[h],s[h+1]),t.lineTo(s[f],s[f+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){e===void 0&&(!t||typeof t.moveTo!="function")&&(e=t,t=null),e=e==null?2:+e;const s=t==null?t=new X:void 0,{points:n}=this;for(let i=0,r=n.length;i<r;i+=2){const o=n[i],a=n[i+1];t.moveTo(o+e,a),t.arc(o,a,e,0,Te)}return s&&s.value()}renderHull(t){const e=t==null?t=new X:void 0,{hull:s,points:n}=this,i=s[0]*2,r=s.length;t.moveTo(n[i],n[i+1]);for(let o=1;o<r;++o){const a=2*s[o];t.lineTo(n[a],n[a+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new _t;return this.renderHull(t),t.value()}renderTriangle(t,e){const s=e==null?e=new X:void 0,{points:n,triangles:i}=this,r=i[t*=3]*2,o=i[t+1]*2,a=i[t+2]*2;return e.moveTo(n[r],n[r+1]),e.lineTo(n[o],n[o+1]),e.lineTo(n[a],n[a+1]),e.closePath(),s&&s.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,s=t.length/3;e<s;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new _t;return this.renderTriangle(t,e),e.value()}}function Ce(l,t,e,s){const n=l.length,i=new Float64Array(n*2);for(let r=0;r<n;++r){const o=l[r];i[r*2]=t.call(s,o,r,l),i[r*2+1]=e.call(s,o,r,l)}return i}function*Ne(l,t,e,s){let n=0;for(const i of l)yield t.call(s,i,n,l),yield e.call(s,i,n,l),++n}const $e=l=>{if(l.length<3)return[0,0];let t=0,e=0;l.forEach(f=>{t+=f[0],e+=f[1]}),t/=l.length,e/=l.length;const s=Math.floor(Math.random()*(l.length-1)),n=l[s],i=l[s+1];let r=Math.random(),o=Math.random();r+o>1&&(r=1-r,o=1-o);const a=t+r*(n[0]-t)+o*(i[0]-t),h=e+r*(n[1]-e)+o*(i[1]-e);return[a,h]},Re=({position:l,color:t,onMount:e})=>{const s=M.useRef(null),[n,i]=M.useState(1),[r,o]=M.useState(1);return M.useEffect(e,[]),mt(()=>{s.current&&(i(a=>a*.92),o(a=>a*.95))}),w.jsxs("mesh",{position:l,ref:s,scale:r,children:[w.jsx("sphereGeometry",{args:[.08,8,8]}),w.jsx("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:15,transparent:!0,opacity:n}),w.jsx("pointLight",{distance:1,intensity:15*n,color:t})]})},Fe=({points:l,color:t,label:e,active:s,onHover:n,count:i,activeZone:r,onPointerEnter:o,onPointerLeave:a,pulse:h})=>{const f=M.useRef(null),[c,u]=M.useState([]),d=M.useRef(0),y=M.useMemo(()=>{const m=new ee;return!l||l.length===0||(l.forEach((b,_)=>{_===0?m.moveTo(b[0],b[1]):m.lineTo(b[0],b[1])}),m.closePath()),m},[l]),p=M.useMemo(()=>{if(!l||l.length===0)return new Float32Array(0);const m=[];for(const b of l)m.push(b[0],b[1],.01);return m.push(l[0][0],l[0][1],.01),new Float32Array(m)},[l]),g=M.useMemo(()=>{if(!l||l.length===0)return[0,0,0];let m=0,b=0;return l.forEach(_=>{m+=_[0],b+=_[1]}),[m/l.length,b/l.length,.2]},[l]);return M.useEffect(()=>{if(h){const[m,b]=$e(l),_=d.current++;u(P=>[...P,{id:_,position:[m,b,.5],color:t}])}},[h,l,t]),mt(m=>{if(f.current){const b=s?.6:0;f.current.position.z=ie.lerp(f.current.position.z,b,.1);const _=f.current.material;if(s)_.opacity=.95,_.emissiveIntensity=4;else{const P=Math.sin(m.clock.elapsedTime*.8+e.length)*.1+.3;_.opacity=P,_.emissiveIntensity=P*2}}}),!l||l.length===0?null:w.jsxs("group",{children:[w.jsxs("mesh",{ref:f,onPointerOver:m=>{m.stopPropagation(),n(e)},onPointerOut:m=>{m.stopPropagation(),n(null)},onPointerEnter:m=>{m.stopPropagation(),o(e)},onPointerLeave:m=>{m.stopPropagation(),a(null)},children:[w.jsx("shapeGeometry",{args:[y]}),w.jsx("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:.3,transparent:!0,opacity:.25,side:$t}),w.jsxs("line",{children:[w.jsx("bufferGeometry",{children:w.jsx("bufferAttribute",{attach:"attributes-position",count:l.length+1,array:p,itemSize:3,args:[p,3]})}),w.jsx("lineBasicMaterial",{color:t,transparent:!0,opacity:s?1:.3})]}),(s||r===e)&&w.jsx(bt,{position:[0,0,.5],center:!0,pointerEvents:"none",children:w.jsxs("div",{className:`px-2 py-1 rounded backdrop-blur-md border ${r===e?"border-white bg-white/10":"border-white/20 bg-black/40"}`,children:[w.jsx("div",{className:"text-[10px] font-black text-white uppercase tracking-widest whitespace-nowrap",style:{textShadow:"0 2px 10px rgba(0,0,0,0.8)"},children:ft[e]||e}),w.jsxs("div",{className:"text-[7px] text-white/60 font-mono text-center",children:[Math.round(i)," ЮНИТОВ"]})]})})]}),c.map(m=>w.jsx(Re,{position:m.position,color:m.color,onMount:()=>{const b=setTimeout(()=>{u(_=>_.filter(P=>P.id!==m.id))},1e3);return()=>clearTimeout(b)}},m.id)),w.jsx(ne,{position:[g[0],g[1],s?g[2]+.6:g[2]],fontSize:s?.25:.18,color:"white",fillOpacity:s?1:.4,anchorX:"center",anchorY:"middle",children:Math.round(i)}),s&&w.jsx(bt,{position:[g[0],g[1]-.5,1],center:!0,pointerEvents:"none",zIndexRange:[100,0],children:w.jsx("div",{className:"text-[14px] font-black text-blue-500 uppercase tracking-widest whitespace-nowrap",style:{textShadow:"0 2px 10px rgba(0,0,0,0.8)"},children:ft[e]||e.toUpperCase()})})]})},Oe=({position:l,name:t,themeColor:e,isActive:s,lastAction:n})=>{const i=M.useRef(null),r=M.useRef(new it(...l)),[o,a]=M.useState(null);return M.useEffect(()=>{i.current&&i.current.position.length()===0&&i.current.position.set(l[0],l[1],l[2])},[]),M.useEffect(()=>{r.current.set(l[0],l[1],l[2])},[l]),M.useEffect(()=>{if(n){a(n);const h=setTimeout(()=>a(null),3e3);return()=>clearTimeout(h)}},[n]),mt((h,f)=>{if(i.current){i.current.position.lerp(r.current,f*2.5);const c=(s?1.3:1)+Math.sin(h.clock.elapsedTime*3+t.length)*.1;i.current.scale.setScalar(c)}}),w.jsxs("group",{children:[w.jsxs("mesh",{ref:i,children:[w.jsx("sphereGeometry",{args:[.06,8,8]}),w.jsx("meshStandardMaterial",{color:e,emissive:e,emissiveIntensity:s?6:1.2,transparent:!0,opacity:.9})]}),(s||o)&&w.jsx(bt,{position:l,center:!0,distanceFactor:15,pointerEvents:"none",style:{transition:"opacity 0.5s"},children:w.jsx("div",{className:"flex flex-col items-center gap-1 pointer-events-none select-none",children:w.jsx("div",{className:se("px-1.5 py-0.5 rounded text-[7px] font-black uppercase whitespace-nowrap border backdrop-blur-md shadow-lg",o?"bg-blue-600 border-white text-white animate-bounce":"bg-black/80 border-white/20 text-white/90"),children:o||t.split(" ")[0]})})})]})},ze=()=>{const{clusterMetrics:l,selectableUsers:t,currentUser:e,logs:s}=Yt(),[n,i]=M.useState(null),[r,o]=M.useState(null),a=M.useRef({}),[h,f]=M.useState({});M.useEffect(()=>{const g={};let m=!1;if(l.forEach(b=>{const _=a.current[b.name]||0;b.activeUnits>_&&(g[b.name]=!0,m=!0),a.current[b.name]=b.activeUnits}),m){f(g);const b=setTimeout(()=>f({}),300);return()=>clearTimeout(b)}},[l]);const c=M.useMemo(()=>l.filter(g=>g.activeUnits>0),[l]),u=M.useMemo(()=>{const g=c.length;if(g===0)return[];const m=16,b=12,_=c.map((P,A)=>{const j=A/g*Math.PI*2,C=3.5+Math.sin(A*1.5)*1.5,T=Math.sin(A*31.5)*.8,x=Math.cos(A*24.2)*.8;return[Math.cos(j)*C+T,Math.sin(j)*C+x]});try{const A=wt.from(_).voronoi([-m/3,-b/3,m/3,b/3]);return c.map((j,C)=>{const T=Array.from(A.cellPolygon(C)||[]);let x=0,S=0;return T.forEach(v=>{x+=v[0],S+=v[1]}),{name:j.name,points:T,centroid:[x/T.length,S/T.length],color:Tt[j.name]||"#ffffff",intensity:j.activeUnits,activeUnits:j.activeUnits}})}catch(P){return console.error("Voronoi Error:",P),[]}},[c]),d=M.useMemo(()=>t.map((g,m)=>{const b=g.stats&&Object.entries(g.stats).sort((T,x)=>x[1]-T[1])[0]?.[0]||"Science",_=u.find(T=>T.name===b);if(!_)return null;const P=Math.sin(m*17.5)*1.2,A=Math.cos(m*21.2)*1.2,j=s.find(T=>T.userId===g.name),C=j&&Date.now()-j.timestamp<3e3;return{id:g.id,name:g.name,position:[_.centroid[0]+P,_.centroid[1]+A,.15],themeColor:_.color,isActive:e.id===g.id,lastAction:C?j.action:null}}).filter(Boolean),[t,u,e.id,s]),y=l.find(g=>g.name===n);if(l.length===0)return w.jsxs("div",{className:"w-full h-full bg-[#010101] rounded-2xl overflow-hidden border border-white/5 flex flex-col items-center justify-center gap-4",children:[w.jsx("div",{className:"w-8 h-8 border-2 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"}),w.jsx("span",{className:"text-white/20 text-[10px] uppercase font-black tracking-widest",children:"Стыковка..."})]});const p=[...l].filter(g=>g.activeUnits>0).sort((g,m)=>m.activeUnits-g.activeUnits).slice(0,8);return w.jsxs("div",{className:"w-full h-full bg-[#00050a] rounded-2xl overflow-hidden border border-blue-900/10 relative group shadow-[inset_0_0_70px_rgba(0,10,20,0.9)]",children:[w.jsxs("div",{className:"absolute top-5 left-6 z-10 pointer-events-none",children:[w.jsxs("h3",{className:"text-[10px] font-black text-blue-400 uppercase tracking-[0.6em] flex items-center gap-2",children:[w.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 shadow-[0_0_10px_#60a5fa]"}),"ПОНТОН: АРХИПЕЛАГ_v5"]}),w.jsx("p",{className:"text-[7px] text-blue-300/30 mt-1 font-mono uppercase tracking-[0.1em]",children:"Гибкое Распределение Доменов"})]}),w.jsxs(qt,{gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},camera:{position:[0,-12,18],fov:32},children:[w.jsx(Qt,{enableZoom:!1,maxPolarAngle:Math.PI/2.3,minPolarAngle:Math.PI/4,enablePan:!1}),w.jsx("ambientLight",{intensity:1.5}),w.jsx("pointLight",{position:[5,10,10],intensity:3,color:Jt.secondary}),w.jsx(te,{speed:1.2,rotationIntensity:.05,floatIntensity:.4,children:w.jsxs("group",{rotation:[-Math.PI/10,0,0],children:[u.map(g=>w.jsx(Fe,{points:g.points,color:g.color,label:g.name,count:g.intensity,active:n===g.name,pulse:h[g.name],onHover:i,activeZone:r,onPointerEnter:o,onPointerLeave:o},g.name)),d.map(g=>w.jsx(Oe,{position:g.position,name:g.name,themeColor:g.themeColor,isActive:g.isActive,lastAction:g.lastAction},g.id)),w.jsx("gridHelper",{args:[24,12],rotation:[Math.PI/2,0,0],position:[0,0,-.1],children:w.jsx("meshBasicMaterial",{color:"#00ffff",transparent:!0,opacity:.02})})]})})]}),w.jsxs("div",{className:"absolute top-5 right-6 text-right pointer-events-none",children:[w.jsx("div",{className:"text-[16px] font-black text-white tabular-nums tracking-tighter",children:y?y.activeUnits:"ОЖИДАНИЕ"}),w.jsx("div",{className:"text-[7px] text-blue-300/30 uppercase font-black tracking-widest mt-0.5",children:y&&n?`${ft[n]||n} ЕМКОСТЬ`:"ВЫБЕРИТЕ ОСТРОВ"})]}),w.jsxs("div",{className:"absolute bottom-5 left-6 right-6 flex justify-between items-end pointer-events-none",children:[w.jsx("div",{className:"flex gap-4",children:p.map(g=>w.jsxs("div",{className:"flex flex-col gap-1",children:[w.jsx("div",{className:"w-10 h-0.5 bg-blue-900/10 overflow-hidden",children:w.jsx("div",{className:"h-full",style:{width:"100%",backgroundColor:Tt[g.name]}})}),w.jsx("span",{className:"text-[6px] font-black text-blue-300/20 uppercase tracking-tighter",children:(ft[g.name]||g.name).slice(0,3)})]},g.name))}),w.jsx("div",{className:"flex flex-col items-end gap-1",children:w.jsx("div",{className:"flex items-center gap-1.5",children:w.jsx("span",{className:"text-[8px] font-black text-cyan-400/80 tabular-nums uppercase tracking-widest border border-cyan-400/20 px-2 py-0.5 rounded-sm bg-cyan-900/10",children:"СТАБИЛЬНЫЙ_ПОТОК"})})})]})]})};export{ze as StrategicVoronoiMap};
