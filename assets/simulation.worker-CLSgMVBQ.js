(function(){"use strict";const v=["Education","Science","Labor","Culture","Volunteering","Patriotism","Sports","HealthyLifestyle","Media","Diplomacy","Ecology","Tourism"],E=["ПМЭФ-2026","Бизнес-инкубатор","Креативный кластер","Технопарк","Умный Квартал","Био-лаборатория","Цифровая Арена","Центр Урбанистики","Кибер-кафе"],S={Education:["Новая педагогика","EdTech платформы","Геймификация","Наставничество"],Science:["Квантовые вычисления","Космос","Биотех","Нейросети"],Labor:["Стартапы","Карьерный трек","Фриланс","Финансовая грамотность"],Culture:["Цифровое искусство","Креативные индустрии","Наследие","Дизайн"],Volunteering:["Эко-акции","Социальная помощь","Донорство","Зоозащита"],Patriotism:["История","Поисковые отряды","Краеведение","Герои нашего времени"],Sports:["Киберспорт","Воркаут","Йога","Марафоны"],HealthyLifestyle:["Биохакинг","Правильное питание","Ментал хелс","Режим дня"],Media:["Блогинг","Подкасты","Новые медиа","Фактчекинг"],Diplomacy:["Мягкая сила","Культурный обмен","Языкознание","Переговоры"],Ecology:["Переработка","Устойчивое развитие","Озеленение","Климат"],Tourism:["Внутренний туризм","Экотропы","Гастротуры","Кемпинг"]},b={Education:["Лекция","Семинар","Мастер-класс","Курс"],Science:["Хакатон","Симпозиум","Лабораторная","Открытие"],Labor:["Ярмарка вакансий","Питч-сессия","Бизнес-завтрак","Тренинг"],Culture:["Выставка","Концерт","Перформанс","Показ"],Volunteering:["Сбор","Акция","Выезд","Помощь"],Patriotism:["Встреча","Реконструкция","Урок мужества","Экскурсия"],Sports:["Турнир","Забег","Матч","Тренировка"],HealthyLifestyle:["Чек-ап","Медитация","Воркшоп","Пробежка"],Media:["Стрим","Интервью","Пресс-тур","Медиа-школа"],Diplomacy:["Дебаты","Форум","Модель ООН","Круглый стол"],Ecology:["Субботник","Сбор сырья","Лекторий","Посадка"],Tourism:["Поход","Слет","Тур","Экспедиция"]};let f=[],c=[],d=[],p=!1,T=1,h=null;const k=()=>{const a=[{action:"Просмотр анонса",evidenceType:"mobile"},{action:"Переход по ссылке",evidenceType:"web"},{action:"Геовход зафиксирован",evidenceType:"sensor"},{action:"Регистрация скан",evidenceType:"platform"},{action:"Фото сделано",evidenceType:"mobile"}];return a[Math.floor(Math.random()*a.length)]};let i={};const w=.99,A=a=>{a.forEach(({oldCluster:e,newCluster:s})=>{if(e===s)return;const l=[e,s].sort().join("-");i[l]=(i[l]||0)+1});const r=[];for(const e in i){if(i[e]*=w,i[e]<.1){delete i[e];continue}const[s,l]=e.split("-"),t=Math.min(i[e]/5,1);r.push({source:s,target:l,weight:t})}const o=c.filter(e=>Object.keys(e.stats).filter(s=>e.stats[s]>0).length>2).sort((e,s)=>s.eventsAttended-e.eventsAttended).slice(0,3).map(e=>e.name);return{edges:r,influencers:o}},y=()=>{if(!c.length)return;const a=Math.floor(Math.random()*3)+1,r=[],o=[];for(let s=0;s<a;s++){const l=Math.floor(Math.random()*c.length),t=c[l],L=Math.random(),m=t.stats?Object.keys(t.stats).reduce((u,M)=>t.stats[u]>t.stats[M]?u:M):"Science",N=t.stats&&Object.keys(t.stats).length>1?Object.keys(t.stats).sort((u,M)=>t.stats[M]-t.stats[u])[1]:m;let n;L>.6?n=v[Math.floor(Math.random()*v.length)]:L>.3?n=Math.random()>.5?m:N:n=m,n!==m&&o.push({userId:t.name,oldCluster:m,newCluster:n});const C=Math.random()>.8?"Low":Math.random()>.5?"Medium":"High",O=E[Math.floor(Math.random()*E.length)],I=k(),P=S[n][Math.floor(Math.random()*S[n].length)],D=b[n][Math.floor(Math.random()*b[n].length)],_={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),userId:t.name,cluster:n,zone:O,evidenceLevel:C,method:"NFC",action:I.action,evidenceType:I.evidenceType,cognitiveLoad:Math.random()*10,topic:P,eventType:D,latency:Math.floor(Math.random()*190)+10};r.push(_),C!=="Low"&&(c[l]={...t,eventsAttended:t.eventsAttended+1,stats:{...t.stats,[n]:(t.stats[n]||0)+1}});const g=d.findIndex(u=>u.name===n);g!==-1&&(d[g]={...d[g],activeUnits:d[g].activeUnits+1})}f=[...r,...f].slice(0,500);const e=A(o);self.postMessage({type:"UPDATE",payload:{logs:f,users:c,metrics:d,graphStats:e}})};self.onmessage=a=>{const{type:r,payload:o}=a.data;switch(r){case"INIT":c=o.users,d=o.metrics,f=o.logs,y();break;case"START":if(p)return;p=!0,h=setInterval(y,1e3/T);break;case"STOP":p=!1,h&&clearInterval(h);break;case"SET_SPEED":T=o,p&&(h&&clearInterval(h),h=setInterval(y,1e3/T));break;case"STEP":y();break}}})();
