(function(){"use strict";const y=["Science","Technology","Economics","Society","Politics","Art","Health"],S=["ПМЭФ-2026","Бизнес-инкубатор","Креативный кластер","Технопарк","Умный Квартал","Био-лаборатория","Цифровая Арена","Центр Урбанистики","Кибер-кафе"],E={Science:["Квантовые вычисления","Генетическая терапия","Космическая логистика","Нейроинтерфейсы"],Technology:["Когнитивные Технологии","Блокчейн-сети","Робототехника","Зеленая Энергетика"],Economics:["Цифровые валюты","Цикличная экономика","Токенизация активов","Алгоритмический трейдинг"],Society:["Цифровая демократия","Инклюзивность","Социальный капитал","Новое образование","Патриотика"],Politics:["Кибербезопасность","Глобальное управление","Регулирование ИИ","Сетевой суверенитет"],Art:["NFT-галереи","Алгоритмическое искусство","Виртуальная мода","Интерактивные медиа"],Health:["Персонализированная медицина","Биохакинг","Долголетие","Спорт"]},I={Science:["Симпозиум","Воркшоп","Лекция","Хакатон","Панель"],Technology:["Демо-день","Кодинг-сессия","Запуск продукта","Конференция","Митап"],Economics:["Форум","Страт-сессия","Инвест-питч","Круглый стол","Аукцион"],Society:["Арт-бранч","Дискуссия","Фестиваль","Выставка","Перформанс"],Politics:["Дебаты","Саммит","Брифинг","Конгресс","Семинар"],Art:["Вернисаж","Показ","Инсталляция","Концерт","Рейв"],Health:["Тренировка","Чек-ап","Медитация","Марафон","Реабилитация"]};let f=[],i=[],a=[],T=!1,g=1,h=null;const b=()=>{const c=[{action:"Просмотр анонса",evidenceType:"mobile"},{action:"Переход по ссылке",evidenceType:"web"},{action:"Геовход зафиксирован",evidenceType:"sensor"},{action:"Регистрация скан",evidenceType:"platform"},{action:"Фото сделано",evidenceType:"mobile"}];return c[Math.floor(Math.random()*c.length)]};let r={};const k=.99,w=c=>{c.forEach(({oldCluster:e,newCluster:n})=>{if(e===n)return;const d=[e,n].sort().join("-");r[d]=(r[d]||0)+1});const l=[];for(const e in r){if(r[e]*=k,r[e]<.1){delete r[e];continue}const[n,d]=e.split("-"),t=Math.min(r[e]/5,1);l.push({source:n,target:d,weight:t})}const s=i.filter(e=>Object.keys(e.stats).filter(n=>e.stats[n]>0).length>2).sort((e,n)=>n.eventsAttended-e.eventsAttended).slice(0,3).map(e=>e.name);return{edges:l,influencers:s}},p=()=>{if(!i.length)return;const c=Math.floor(Math.random()*3)+1,l=[],s=[];for(let n=0;n<c;n++){const d=Math.floor(Math.random()*i.length),t=i[d],L=Math.random(),v=t.stats?Object.keys(t.stats).reduce((u,C)=>t.stats[u]>t.stats[C]?u:C):"Science";let o=v;L>.7&&(o=y[Math.floor(Math.random()*y.length)]),o!==v&&s.push({userId:t.name,oldCluster:v,newCluster:o});const M=Math.random()>.8?"Low":Math.random()>.5?"Medium":"High",N=S[Math.floor(Math.random()*S.length)],A=b(),P=E[o][Math.floor(Math.random()*E[o].length)],_=I[o][Math.floor(Math.random()*I[o].length)],O={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),userId:t.name,cluster:o,zone:N,evidenceLevel:M,method:"NFC",action:A.action,evidenceType:A.evidenceType,cognitiveLoad:Math.random()*10,topic:P,eventType:_,latency:Math.floor(Math.random()*190)+10};l.push(O),M!=="Low"&&(i[d]={...t,eventsAttended:t.eventsAttended+1,stats:{...t.stats,[o]:(t.stats[o]||0)+1}});const m=a.findIndex(u=>u.name===o);m!==-1&&(a[m]={...a[m],activeUnits:a[m].activeUnits+1,anomalies:M==="Low"?a[m].anomalies+1:a[m].anomalies})}f=[...l,...f].slice(0,500);const e=w(s);self.postMessage({type:"UPDATE",payload:{logs:f,users:i,metrics:a,graphStats:e}})};self.onmessage=c=>{const{type:l,payload:s}=c.data;switch(l){case"INIT":i=s.users,a=s.metrics,f=s.logs,p();break;case"START":if(T)return;T=!0,h=setInterval(p,1e3/g);break;case"STOP":T=!1,h&&clearInterval(h);break;case"SET_SPEED":g=s,T&&(h&&clearInterval(h),h=setInterval(p,1e3/g));break;case"STEP":p();break}}})();
